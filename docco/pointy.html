<!DOCTYPE html>

<html>
<head>
  <title>pointy.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="breakpoints.html">
                breakpoints.js
              </a>
            
              
              <a class="source" href="date-parse.html">
                date-parse.js
              </a>
            
              
              <a class="source" href="jquery.breakpoints.html">
                jquery.breakpoints.js
              </a>
            
              
              <a class="source" href="jquery.calcRestrainedPos.html">
                jquery.calcRestrainedPos.js
              </a>
            
              
              <a class="source" href="jquery.clientRect.html">
                jquery.clientRect.js
              </a>
            
              
              <a class="source" href="jquery.contentSize.html">
                jquery.contentSize.js
              </a>
            
              
              <a class="source" href="jquery.cookies.html">
                jquery.cookies.js
              </a>
            
              
              <a class="source" href="jquery.css.html">
                jquery.css.js
              </a>
            
              
              <a class="source" href="jquery.customEvent.html">
                jquery.customEvent.js
              </a>
            
              
              <a class="source" href="jquery.delimitedString.html">
                jquery.delimitedString.js
              </a>
            
              
              <a class="source" href="jquery.disableEvent.html">
                jquery.disableEvent.js
              </a>
            
              
              <a class="source" href="jquery.hostIframe.html">
                jquery.hostIframe.js
              </a>
            
              
              <a class="source" href="jquery.hoverDelay.html">
                jquery.hoverDelay.js
              </a>
            
              
              <a class="source" href="jquery.htmlEncode.html">
                jquery.htmlEncode.js
              </a>
            
              
              <a class="source" href="jquery.imageSize.html">
                jquery.imageSize.js
              </a>
            
              
              <a class="source" href="jquery.isVisibleKeyCode.html">
                jquery.isVisibleKeyCode.js
              </a>
            
              
              <a class="source" href="jquery.menu.html">
                jquery.menu.js
              </a>
            
              
              <a class="source" href="jquery-menu-exampleskin.html">
                jquery-menu-exampleskin.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.deviceFixes.html">
                jquery.modalDialog.deviceFixes.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.getSettings.html">
                jquery.modalDialog.getSettings.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.header.html">
                jquery.modalDialog.header.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.history.html">
                jquery.modalDialog.history.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.html">
                jquery.modalDialog.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.unobtrusive.html">
                jquery.modalDialog.unobtrusive.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.userAgent.html">
                jquery.modalDialog.userAgent.js
              </a>
            
              
              <a class="source" href="jquery.modalDialogContent.header.html">
                jquery.modalDialogContent.header.js
              </a>
            
              
              <a class="source" href="jquery.modalDialogContent.html">
                jquery.modalDialogContent.js
              </a>
            
              
              <a class="source" href="jquery.msAjax.html">
                jquery.msAjax.js
              </a>
            
              
              <a class="source" href="jquery.ns.html">
                jquery.ns.js
              </a>
            
              
              <a class="source" href="jquery.partialLoad.html">
                jquery.partialLoad.js
              </a>
            
              
              <a class="source" href="jquery.postMessage.html">
                jquery.postMessage.js
              </a>
            
              
              <a class="source" href="jquery.proxyAll.html">
                jquery.proxyAll.js
              </a>
            
              
              <a class="source" href="jquery.queryString.html">
                jquery.queryString.js
              </a>
            
              
              <a class="source" href="jquery.richTooltip.html">
                jquery.richTooltip.js
              </a>
            
              
              <a class="source" href="jquery.scrollAnchor.html">
                jquery.scrollAnchor.js
              </a>
            
              
              <a class="source" href="jquery.uncomment.html">
                jquery.uncomment.js
              </a>
            
              
              <a class="source" href="jquery.url.html">
                jquery.url.js
              </a>
            
              
              <a class="source" href="pointy.gestures.html">
                pointy.gestures.js
              </a>
            
              
              <a class="source" href="pointy.html">
                pointy.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>pointy.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*!
 * Pointy.js
 * Pointer Events polyfill for jQuery
 * https://github.com/vistaprint/PointyJS
 *
 * Depends on jQuery, see http://jquery.org
 *
 * Developed by Vistaprint.com
 */</span>

(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($, window, document, undefined)</span> </span>{

    <span class="hljs-keyword">var</span> support = {
        touch: <span class="hljs-string">"ontouchend"</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">document</span>,
        pointer: !! (navigator.pointerEnabled || navigator.msPointerEnabled)
    };

    $.extend($.support, support);

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">triggerCustomEvent</span><span class="hljs-params">(elem, eventType, originalEvent)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>support for IE7-IE8</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        originalEvent = originalEvent || <span class="hljs-built_in">window</span>.event;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Create a writable copy of the event object and normalize some properties</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> event = <span class="hljs-keyword">new</span> jQuery.Event(originalEvent);
        event.type = eventType;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Copy over properties for ease of access</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> i, copy = $.event.props.concat($.event.pointerHooks.props);
        i = copy.length;
        <span class="hljs-keyword">while</span> (i--) {
            <span class="hljs-keyword">var</span> prop = copy[i];
            event[prop] = originalEvent[prop];
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Support: IE&lt;9
Fix target property (#1925)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!event.target) {
            event.target = originalEvent.srcElement || <span class="hljs-built_in">document</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Support: Chrome 23+, Safari?
Target should not be a text node (#504, #13143)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (event.target.nodeType === <span class="hljs-number">3</span>) {
            event.target = event.target.parentNode;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Support: IE&lt;9
For mouse/key events, metaKey==false if it’s undefined (#3368, #11328)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        event.metaKey = !! event.metaKey;</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>run the filter now</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        event = $.event.pointerHooks.filter(event, originalEvent);</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>trigger the emulated pointer event
the filter can return an array (only if the original was a touchmove),
which means we need to trigger independent events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ($.isArray(event)) {
            $.each(event, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(i, ev)</span> </span>{
                $.event.dispatch.call(elem, ev);
            });
        } <span class="hljs-keyword">else</span> {
            $.event.dispatch.call(elem, event);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>return the manipulated jQuery event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> event;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addEvent</span><span class="hljs-params">(elem, type, selector, func)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>when we have a selector, let jQuery do the delegation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (selector) {
            func._pointerEventWrapper = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event)</span> </span>{
                <span class="hljs-keyword">return</span> func.call(elem, event.originalEvent);
            };

            $(elem).on(type, selector, func._pointerEventWrapper);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>if we do not have a selector, we optimize by cutting jQuery out</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (elem.addEventListener) {
                elem.addEventListener(type, func, <span class="hljs-literal">false</span>);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (elem.attachEvent) {</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>bind the function to correct “this” for IE8-</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                func._pointerEventWrapper = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> </span>{
                    <span class="hljs-keyword">return</span> func.call(elem, e);
                };

                elem.attachEvent(<span class="hljs-string">"on"</span> + type, func._pointerEventWrapper);
            }
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeEvent</span><span class="hljs-params">(elem, type, selector, func)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Make sure for IE8- we unbind the wrapper</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (func._pointerEventWrapper) {
            func = func._pointerEventWrapper;
        }

        <span class="hljs-keyword">if</span> (selector) {
            $(elem).off(type, selector, func);
        } <span class="hljs-keyword">else</span> {
            $.removeEvent(elem, type, func);
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>get the standardized “buttons” property as per the Pointer Events spec from a mouse event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getStandardizedButtonsProperty</span><span class="hljs-params">(event)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>in the DOM LEVEL 3 spec there is a new standard for the “buttons” property
sadly, no browser currently supports this and only sends us the single “button” property</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (event.buttons) {
            <span class="hljs-keyword">return</span> event.buttons;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>standardize “which” property for use</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> which = event.which;
        <span class="hljs-keyword">if</span> (!which &amp;&amp; event.button !== <span class="hljs-literal">undefined</span>) {
            which = (event.button &amp; <span class="hljs-number">1</span> ? <span class="hljs-number">1</span> : (event.button &amp; <span class="hljs-number">2</span> ? <span class="hljs-number">3</span> : (event.button &amp; <span class="hljs-number">4</span> ? <span class="hljs-number">2</span> : <span class="hljs-number">0</span>)));
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>no button down (can happen on mousemove)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (which === <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>left button</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (which === <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>middle mouse</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (which === <span class="hljs-number">2</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-number">4</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>right mouse</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (which === <span class="hljs-number">3</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>unknown?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">returnFalse</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">returnTrue</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; }

    <span class="hljs-keyword">var</span> POINTER_TYPE_UNAVAILABLE = <span class="hljs-string">"unavailable"</span>;
    <span class="hljs-keyword">var</span> POINTER_TYPE_TOUCH = <span class="hljs-string">"touch"</span>;
    <span class="hljs-keyword">var</span> POINTER_TYPE_PEN = <span class="hljs-string">"pen"</span>;
    <span class="hljs-keyword">var</span> POINTER_TYPE_MOUSE = <span class="hljs-string">"mouse"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>indicator to mark whether touch events are in progress
when null, it means we have never received a touch event
when number, user is currently touching something
when false, user just released their finger (reset on mousedown if needed)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> _touching = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>bitmask to identify which buttons are currently down</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> _buttons = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>storage of the last seen touches provided by the native touch events spec</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> _lastTouches = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>——— NOTE: THIS IS UNUSED, WE DO NOT ASSIGN BUTTON ———
pointer events defines the “button” property as:
mouse move (no buttons down)                         -1
left mouse, touch contact and normal pen contact     0
middle mouse                                         1
right mouse, pen with barrel button pressed          2
x1 (back button on mouse)                            3
x2 (forward button on mouse)                         4
pen contact with eraser button pressed               5
——— NOTE: THIS IS UNUSED, WE DO NOT ASSIGN BUTTON ———</p>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>pointer events defines the “buttons” property as:
mouse move (no buttons down)                         0
left mouse, touch contact, and normal pen contact    1
middle mouse                                         4
right mouse, pen contact with barrel button pressed  2
x1 (back) mouse                                      8
x2 (forward) mouse                                   16
pen contact with eraser button pressed               32</p>

            </div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>add our own pointer event hook/filter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.event.pointerHooks = {
        props: <span class="hljs-string">"pointerType pointerId pressure buttons clientX clientY relatedTarget fromElement offsetX offsetY pageX pageY screenX screenY width height toElement"</span>.split(<span class="hljs-string">" "</span>),
        filter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event, original)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Calculate pageX/Y if missing and clientX/Y available
this is just copied from jQuery’s standard pageX/pageY fix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (!original.touches &amp;&amp; event.pageX == <span class="hljs-literal">null</span> &amp;&amp; original.clientX != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">var</span> eventDoc = event.target.ownerDocument || <span class="hljs-built_in">document</span>;
                <span class="hljs-keyword">var</span> doc = eventDoc.documentElement;
                <span class="hljs-keyword">var</span> body = eventDoc.body;

                event.pageX = original.clientX + (doc &amp;&amp; doc.scrollLeft || body &amp;&amp; body.scrollLeft || <span class="hljs-number">0</span>) - (doc &amp;&amp; doc.clientLeft || body &amp;&amp; body.clientLeft || <span class="hljs-number">0</span>);
                event.pageY = original.clientY + (doc &amp;&amp; doc.scrollTop || body &amp;&amp; body.scrollTop || <span class="hljs-number">0</span>) - (doc &amp;&amp; doc.clientTop || body &amp;&amp; body.clientTop || <span class="hljs-number">0</span>);
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Add relatedTarget, if necessary
also copied from jQuery’s standard event fix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (!event.relatedTarget &amp;&amp; original.fromElement) {
                event.relatedTarget = original.fromElement === event.target ? original.toElement : original.fromElement;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Add pointerType</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (!event.pointerType || <span class="hljs-keyword">typeof</span> event.pointerType === <span class="hljs-string">"number"</span>) {
                <span class="hljs-keyword">if</span> (event.pointerType == <span class="hljs-number">2</span>) {
                    event.pointerType = POINTER_TYPE_TOUCH;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.pointerType == <span class="hljs-number">3</span>) {
                    event.pointerType = POINTER_TYPE_PEN;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.pointerType == <span class="hljs-number">4</span>) {
                    event.pointerType = POINTER_TYPE_MOUSE;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^touch/i</span>.test(original.type)) {
                    event.pointerType = POINTER_TYPE_TOUCH;
                    event.buttons = original.type === <span class="hljs-string">"touchend"</span> || original.type === <span class="hljs-string">"touchcancel"</span> ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^mouse/i</span>.test(original.type) || original.type === <span class="hljs-string">"click"</span>) {
                    event.pointerId = <span class="hljs-number">1</span>; <span class="hljs-comment">// as per the pointer events spec, the mouse is always pointer id 1</span>
                    event.pointerType = POINTER_TYPE_MOUSE;
                    event.buttons = original.type === <span class="hljs-string">"mouseup"</span> ? <span class="hljs-number">0</span> : getStandardizedButtonsProperty(original);
                } <span class="hljs-keyword">else</span> {
                    event.pointerType = POINTER_TYPE_UNAVAILABLE;
                    event.buttons = <span class="hljs-number">0</span>;
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>if we have the bitmask for the depressed buttons from the mouse events polyfill, use it to mimic buttons for
browsers that do not support the HTML DOM LEVEL 3 events spec</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (event.type !== <span class="hljs-string">"pointerdown"</span> &amp;&amp; event.pointerType === <span class="hljs-string">"mouse"</span> &amp;&amp; _touching === <span class="hljs-literal">null</span> &amp;&amp; _buttons !== event.buttons) {
                event.buttons = _buttons;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>standardize the pressure attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (!event.pressure) {
                event.pressure = event.buttons &gt; <span class="hljs-number">0</span> ? <span class="hljs-number">0.5</span> : <span class="hljs-number">0</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>standardize the width and height, these represent the contact geometry</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (event.width === <span class="hljs-literal">undefined</span> || event.height === <span class="hljs-literal">undefined</span>) {
                event.width = event.height = <span class="hljs-number">0</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>prevent the following native “click” event from occurring, can be used to prevent
clicks on “pointerdown” or “pointerup” or from gestures like “press” and “presshold”</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            event.preventClick = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                event.isClickPrevented = returnTrue;
                $(event.target).one(<span class="hljs-string">"click"</span>, returnFalse);
            };

            event.isClickPrevented = returnFalse;</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>touch events send an array of touches we need to convert to the pointer events format
which means we need to fire multiple events per touch</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (original.touches &amp;&amp; event.type !== <span class="hljs-string">"pointercancel"</span>) {
                <span class="hljs-keyword">var</span> touches = original.touches;
                <span class="hljs-keyword">var</span> events = [];
                <span class="hljs-keyword">var</span> ev, i, j;</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>the problem with this is that on “touchend” it will remove the
touch which has ended from the touches list, this means we do
not want to fire “pointerup” for touches that are still there,
we instead want to send a “pointerup” with the removed touch’s identifier</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (event.type === <span class="hljs-string">"pointerup"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>convert TouchList to a standard array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    _lastTouches = <span class="hljs-built_in">Array</span>.prototype.slice.call(_lastTouches);</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>find the touch that was removed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; original.touches.length; i++) {
                        <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; _lastTouches.length; j++) {
                            <span class="hljs-keyword">if</span> (_lastTouches[j].identifier === original.touches[i].identifier) {
                                _lastTouches.splice(j, <span class="hljs-number">1</span>);
                            }
                        }
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>if we narrowed down the ended touch to one, then we found it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (_lastTouches.length === <span class="hljs-number">1</span>) {
                        event.pointerId = _lastTouches[<span class="hljs-number">0</span>].identifier;
                        _lastTouches = original.touches;
                        <span class="hljs-keyword">return</span> event;
                    }
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>on “pointerdown” we need to only trigger a new “pointerdown” for the new touches (fingers),
and not the touches that were already active. Therefore we filter out all of the touches
based on their identifier that we already knew were active before</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.type === <span class="hljs-string">"pointerdown"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>convert TouchList to a standard array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    touches = <span class="hljs-built_in">Array</span>.prototype.slice.call(original.touches);</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>find the new touch that was just added</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; touches.length; i++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>last touches will be a list with one less touch</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; _lastTouches.length; j++) {
                            <span class="hljs-keyword">if</span> (touches[i].identifier === _lastTouches[j].identifier) {
                                touches.splice(i, <span class="hljs-number">1</span>);
                            }
                        }
                    }
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>this will be used on pointermove and pointerdown</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; original.touches.length; i++) {
                    <span class="hljs-keyword">var</span> touch = original.touches[i];
                    ev = $.extend({}, event);</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>copy over information from the touch to the event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    ev.clientX = touch.clientX;
                    ev.clientY = touch.clientY;
                    ev.pageX = touch.pageX;
                    ev.pageY = touch.pageY;
                    ev.screenX = touch.screenX;
                    ev.screenY = touch.screenY;</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>the touch id on emulated touch events from chrome is always 0 (zero)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    ev.pointerId = touch.identifier;
                    events.push(ev);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>do as little processing as you can here, this is done on touchmove and
there can be a lot of those events firing quickly, we do not want the
polyfill slowing down the application</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                _lastTouches = original.touches;
                <span class="hljs-keyword">return</span> events;
            }

            <span class="hljs-keyword">return</span> event;
        }
    };

    $.event.delegateSpecial = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(setup)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(handleObj)</span> </span>{
            <span class="hljs-keyword">var</span> thisObject = <span class="hljs-keyword">this</span>,
                data = jQuery._data(thisObject);

            <span class="hljs-keyword">if</span> (!data.pointerEvents) {
                data.pointerEvents = {};
            }

            <span class="hljs-keyword">if</span> (!data.pointerEvents[handleObj.type]) {
                data.pointerEvents[handleObj.type] = [];
            }

            <span class="hljs-keyword">if</span> (!data.pointerEvents[handleObj.type].length) {
                setup.call(thisObject, handleObj);
            }

            data.pointerEvents[handleObj.type].push(handleObj);
        };
    };

    <span class="hljs-keyword">var</span> indexOfArray = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(arr, obj)</span> </span>{
        <span class="hljs-keyword">if</span> (arr.indexOf) {
            <span class="hljs-keyword">return</span> arr.indexOf(obj);
        }

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;arr.length; i++) {
            <span class="hljs-keyword">if</span> (arr[i] === obj) {
                <span class="hljs-keyword">return</span> i;
            }
        }

        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
    };

    $.event.delegateSpecial.remove = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(teardown)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(handleObj)</span> </span>{
            <span class="hljs-keyword">var</span> handlers,
                thisObject = <span class="hljs-keyword">this</span>,
                data = jQuery._data(thisObject);

            <span class="hljs-keyword">if</span> (!data.pointerEvents) {
                data.pointerEvents = {};
            }

            handlers = data.pointerEvents[handleObj.type];

            handlers.splice(indexOfArray(handlers, handleObj), <span class="hljs-number">1</span>);

            <span class="hljs-keyword">if</span> (!handlers.length) {
                teardown.call(thisObject, handleObj);
            }
        };
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>allow jQuery’s native $.event.fix to find our pointer hooks</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.extend($.event.fixHooks, {
        pointerdown: $.event.pointerHooks,
        pointerup: $.event.pointerHooks,
        pointermove: $.event.pointerHooks,
        pointerover: $.event.pointerHooks,
        pointerout: $.event.pointerHooks,
        pointercancel: $.event.pointerHooks
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>if browser does not natively handle pointer events,
create special custom events to mimic them</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!support.pointer) {</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>stores the scroll-y offest on “touchstart” and is compared
on touchend to see if we should trigger a click event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> _startScrollOffset;</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>utility to return the scroll-y position</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> scrollY = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">window</span>.scrollY || $(<span class="hljs-built_in">window</span>).scrollTop());
        };

        $.event.special.pointerdown = {
            touch: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>set the pointer as currently down to prevent chorded “pointerdown” events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                _touching = event.timeStamp;</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>trigger a new “pointerdown” event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                triggerCustomEvent(<span class="hljs-keyword">this</span>, <span class="hljs-string">"pointerdown"</span>, event);</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>set the scroll offset which is compared on TouchEnd</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                _startScrollOffset = scrollY();</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>no matter what, you cannot simply always call preventDefault() on “touchstart”
this disables scrolling when touching the binded element, which is not appropriate.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            },
            mouse: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>if we just had a “touchstart”, ignore this “mousedown” event, to prevent double firing of “pointerdown”</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> _touching === <span class="hljs-string">"number"</span>) {
                    <span class="hljs-keyword">return</span>;
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>we reset the touch to null, to indicate that we’re listening to mouse events currently</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                _touching = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>update the _buttons bitmask</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> button = getStandardizedButtonsProperty(event);
                <span class="hljs-keyword">var</span> wasAButtonDownAlready = _buttons !== <span class="hljs-number">0</span>;
                _buttons |= button;</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>do not trigger another “pointerdown” event if a button is currently down,
this prevents chorded “pointerdown” events which is defined in the Pointer Events spec</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (wasAButtonDownAlready &amp;&amp; _buttons !== button) {</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>per the Pointer Events spec, when the active buttons change it fires only a “pointermove” event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    triggerCustomEvent(<span class="hljs-keyword">this</span>, <span class="hljs-string">"pointermove"</span>, event);
                    <span class="hljs-keyword">return</span>;
                }

                triggerCustomEvent(<span class="hljs-keyword">this</span>, <span class="hljs-string">"pointerdown"</span>, event);
            },
            add: $.event.delegateSpecial(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(handleObj)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>bind to touch events, some devices (chromebook) can send both touch and mouse events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (support.touch) {
                    addEvent(<span class="hljs-keyword">this</span>, <span class="hljs-string">"touchstart"</span>, handleObj.selector, $.event.special.pointerdown.touch);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>bind to mouse events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                addEvent(<span class="hljs-keyword">this</span>, <span class="hljs-string">"mousedown"</span>, handleObj.selector, $.event.special.pointerdown.mouse);</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>ensure we also bind to “pointerup” to properly clear signals and fire click event on “touchend”</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                handleObj.pointerup = $.noop;
                $(<span class="hljs-keyword">this</span>).on(<span class="hljs-string">"pointerup"</span>, handleObj.selector, handleObj.pointerup);
            }),
            remove: $.event.delegateSpecial.remove(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(handleObj)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>unbind touch events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (support.touch) {
                    removeEvent(<span class="hljs-keyword">this</span>, <span class="hljs-string">"touchstart"</span>, handleObj.selector, $.event.special.pointerdown.touch);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>unbind mouse events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                removeEvent(<span class="hljs-keyword">this</span>, <span class="hljs-string">"mousedown"</span>, handleObj.selector, $.event.special.pointerdown.mouse);</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>unbind the special “pointerup” we added for cleanup</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (handleObj.pointerup) {
                    $(<span class="hljs-keyword">this</span>).off(<span class="hljs-string">"pointerup"</span>, handleObj.selector, handleObj.pointerup);
                }
            })
        };

        $.event.special.pointerup = {
            touch: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>prevent default to prevent the emulated “mouseup” event from being triggered</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                event.preventDefault();</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>safety check, if _touching is null then we just had a mouse event and shouldn’t
listen to touch events right now</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (_touching === <span class="hljs-literal">null</span>) {
                    <span class="hljs-keyword">return</span>;
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>timeStamp of when the last “touchstart” event was triggered,
used to prevent double fire issues on iOS 7+ devices when needed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> lastTouchStarted = _touching;</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>trigger the emulated “pointerup” event, getting back the event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> jEvent = triggerCustomEvent(<span class="hljs-keyword">this</span>, <span class="hljs-string">"pointerup"</span>, event);</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>ensure we have a target before we attempt to deal with a “click” event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (!event.target) {
                    _touching = <span class="hljs-literal">false</span>; <span class="hljs-comment">// release the "pointerdown" lock</span>
                    <span class="hljs-keyword">return</span>;
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>while you may think if we are preventing the next “click” event (see jEvent.isClickPrevented)
we could simply not trigger one below, that turns out to be a bad assumption. Due to the
complex issue of dealing with various devices, often a click event is triggered regardless of
calling preventDefault on “touchend” so we have to still go on and determine if a “click”
event was triggered, if so, render it noop, if not, we don’t have to trigger one then.</p>

            </div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>we confirm that the user did not scroll, as touch events are very related to scrolling on
touch devices, it’s possible we may mis-fire a click event on an <a> anchor tag causing
navigation even though this was a scroll attempt. We let the browser’s built in scrolling
threshold prevent accidental scrolling so we only need to check if they scrolled at all.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (_startScrollOffset !== scrollY()) {
                    _touching = <span class="hljs-literal">false</span>; <span class="hljs-comment">// release the "pointerdown" lock</span>
                    <span class="hljs-keyword">return</span>;
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>on “touchend”, calling prevent default prevents the “mouseup” and “click” event
however on native “mouseup” events preventing default does not cancel the “click” event
as per the pointer event spec on “pointerup” preventing default should not cancel the “click” event</p>
<p>so we really want to have a “click” event all the time. If a function binded to this emulated
“poiunterup” calls prevent default it would result in preventing the “click” event, which would
cause inconsistent behavior. To prevent the possibility of two click events though, we call
prevent default all the time (see above) and then trigger a “click” event here.</p>
<p>Additionally, we are currently looking at the “touchend” event, mobile devices usually add a 300ms
delay before triggering click to check for double tap events (zooming action on most devices).
In certain situations the mobile device will still fire a “click” event even if preventDefault is
called on “touchend”, so we wait the 300ms and look for a click, then only fire a click if none
was fired by the browser</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> clickTimer = setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                    <span class="hljs-keyword">if</span> (_touching === lastTouchStarted) {
                        _touching = <span class="hljs-literal">false</span>; <span class="hljs-comment">// release the "pointerdown" lock</span>
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>at this point, if no click event was triggered, and we don’t want to to trigger a “click”
event, we can simply not trigger one to begin with.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (jEvent.isClickPrevented()) {
                        $(event.target).off(<span class="hljs-string">"click"</span>, returnFalse);
                        <span class="hljs-keyword">return</span>;
                    }

                    <span class="hljs-keyword">if</span> (event.target.click) {
                        event.target.click();
                    } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>iOS 5 and older Android browsers do not define native .click events on all elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        $(event.target).click();
                    }
                }, <span class="hljs-number">300</span>);

                $(event.target).one(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                    <span class="hljs-keyword">if</span> (_touching === lastTouchStarted) {
                        _touching = <span class="hljs-literal">false</span>;
                    }

                    <span class="hljs-keyword">if</span> (clickTimer) {
                        clearTimeout(clickTimer);
                    }
                });
            },
            mouse: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>if originally we had a “touchstart” or we ended with a “touchend” event, ignore this “mouseup”</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (_touching !== <span class="hljs-literal">null</span>) {
                    <span class="hljs-keyword">return</span>;
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>on mouseup, the event.button will be the button that was just released</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                _buttons ^= getStandardizedButtonsProperty(event);</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>we only trigger a “pointerup” event if no buttons are down, prevent chorded PointerDown events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (_buttons === <span class="hljs-number">0</span>) {
                    triggerCustomEvent(<span class="hljs-keyword">this</span>, <span class="hljs-string">"pointerup"</span>, event);
                } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>per the Pointer Events spec, when the active buttons change it fires only a PointerMove event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    triggerCustomEvent(<span class="hljs-keyword">this</span>, <span class="hljs-string">"pointermove"</span>, event);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Mouse Events spec shows that after a “mouseup” it fires a “mousemove”, which will trigger
the “pointermove” needed to follow the Pointer Events spec which describes the same thing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            },
            add: $.event.delegateSpecial(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(handleObj)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>bind to touch events, some devices (chromebook) can send both touch and mouse events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (support.touch) {
                    addEvent(<span class="hljs-keyword">this</span>, <span class="hljs-string">"touchend"</span>, handleObj.selector, $.event.special.pointerup.touch);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>bind mouse events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                addEvent(<span class="hljs-keyword">this</span>, <span class="hljs-string">"mouseup"</span>, handleObj.selector, $.event.special.pointerup.mouse);
            }),
            remove: $.event.delegateSpecial.remove(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(handleObj)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>unbind touch events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (support.touch) {
                    removeEvent(<span class="hljs-keyword">this</span>, <span class="hljs-string">"touchend"</span>, handleObj.selector, $.event.special.pointerup.touch);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>unbind mouse events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                removeEvent(<span class="hljs-keyword">this</span>, <span class="hljs-string">"mouseup"</span>, handleObj.selector, $.event.special.pointerup.mouse);
            })
        };

        $.event.special.pointermove = {
            touch: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event)</span> </span>{
                triggerCustomEvent(<span class="hljs-keyword">this</span>, <span class="hljs-string">"pointermove"</span>, event);
            },
            mouse: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>_touching will be a number if they currently have their finger (touch only) down
because we cannot call preventDefault on the “touchmove” without preventing
scrolling on most things, we do this check to ensure we don’t double fire
move events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> _touching === <span class="hljs-string">"number"</span>) {
                    <span class="hljs-keyword">return</span>;
                }

                triggerCustomEvent(<span class="hljs-keyword">this</span>, <span class="hljs-string">"pointermove"</span>, event);
            },
            add: $.event.delegateSpecial(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(handleObj)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>bind to touch events, some devices (chromebook) can send both touch and mouse events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (support.touch) {
                    addEvent(<span class="hljs-keyword">this</span>, <span class="hljs-string">"touchmove"</span>, handleObj.selector, $.event.special.pointermove.touch);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>bind mouse events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                addEvent(<span class="hljs-keyword">this</span>, <span class="hljs-string">"mousemove"</span>, handleObj.selector, $.event.special.pointermove.mouse);
            }),
            remove: $.event.delegateSpecial.remove(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(handleObj)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>unbind touch events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (support.touch) {
                    removeEvent(<span class="hljs-keyword">this</span>, <span class="hljs-string">"touchmove"</span>, handleObj.selector, $.event.special.pointermove.touch);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>unbind mouse events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                removeEvent(<span class="hljs-keyword">this</span>, <span class="hljs-string">"mousemove"</span>, handleObj.selector, $.event.special.pointermove.mouse);
            })
        };

        jQuery.each({
            pointerover: {
                mouse: <span class="hljs-string">"mouseover"</span>
            },
            pointerout: {
                mouse: <span class="hljs-string">"mouseout"</span>
            },
            pointercancel: {
                touch: <span class="hljs-string">"touchcancel"</span>
            }
        }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(pointerEventType, natives)</span> </span>{
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onTouch</span><span class="hljs-params">(event)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>pointercancel, reset everything</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (event.type === <span class="hljs-string">"touchcancel"</span>) {
                    _touching = <span class="hljs-literal">null</span>;
                    _buttons = <span class="hljs-number">0</span>;
                }

                triggerCustomEvent(<span class="hljs-keyword">this</span>, pointerEventType, event);
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onMouse</span><span class="hljs-params">(event)</span> </span>{
                triggerCustomEvent(<span class="hljs-keyword">this</span>, pointerEventType, event);
            }

            $.event.special[pointerEventType] = {
                setup: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                    <span class="hljs-keyword">if</span> (support.touch &amp;&amp; natives.touch) {
                        addEvent(<span class="hljs-keyword">this</span>, natives.touch, <span class="hljs-literal">null</span>, onTouch);
                    }
                    <span class="hljs-keyword">if</span> (natives.mouse) {
                        addEvent(<span class="hljs-keyword">this</span>, natives.mouse, <span class="hljs-literal">null</span>, onMouse);
                    }
                },
                teardown: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                    <span class="hljs-keyword">if</span> (support.touch &amp;&amp; natives.touch) {
                        removeEvent(<span class="hljs-keyword">this</span>, natives.touch, <span class="hljs-literal">null</span>, onTouch);
                    }
                    <span class="hljs-keyword">if</span> (natives.mouse) {
                        removeEvent(<span class="hljs-keyword">this</span>, natives.mouse, <span class="hljs-literal">null</span>, onMouse);
                    }
                }
            };
        });
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>for IE10 specific, we proxy though events so we do not need to deal
with the various names or renaming of events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (navigator.msPointerEnabled &amp;&amp; !navigator.pointerEnabled) {
        $.extend($.event.special, {
            pointerdown: {
                delegateType: <span class="hljs-string">"MSPointerDown"</span>,
                bindType: <span class="hljs-string">"MSPointerDown"</span>
            },
            pointerup: {
                delegateType: <span class="hljs-string">"MSPointerUp"</span>,
                bindType: <span class="hljs-string">"MSPointerUp"</span>
            },
            pointermove: {
                delegateType: <span class="hljs-string">"MSPointerMove"</span>,
                bindType: <span class="hljs-string">"MSPointerMove"</span>
            },
            pointerover: {
                delegateType: <span class="hljs-string">"MSPointerOver"</span>,
                bindType: <span class="hljs-string">"MSPointerOver"</span>
            },
            pointerout: {
                delegateType: <span class="hljs-string">"MSPointerOut"</span>,
                bindType: <span class="hljs-string">"MSPointerOut"</span>
            },
            pointercancel: {
                delegateType: <span class="hljs-string">"MSPointerCancel"</span>,
                bindType: <span class="hljs-string">"MSPointerCancel"</span>
            }
        });

        $.extend($.event.fixHooks, {
            MSPointerDown: $.event.pointerHooks,
            MSPointerUp: $.event.pointerHooks,
            MSPointerMove: $.event.pointerHooks,
            MSPointerOver: $.event.pointerHooks,
            MSPointerOut: $.event.pointerHooks,
            MSPointerCancel: $.event.pointerHooks
        });
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>add support for pointerenter and pointerlave
pointerenter and pointerleave were added in IE11, they do not exist in IE10</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!support.pointer || (navigator.msPointerEnabled &amp;&amp; !navigator.pointerEnabled)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>Create a wrapper similar to jQuery’s mouseenter/leave events
using pointer events (pointerover/out) and event-time checks</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        jQuery.each({
            pointerenter: navigator.msPointerEnabled ? <span class="hljs-string">"MSPointerOver"</span> : <span class="hljs-string">"mouseover"</span>,
            pointerleave: navigator.msPointerEnabled ? <span class="hljs-string">"MSPointerOut"</span> : <span class="hljs-string">"mouseout"</span>
        }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(orig, fix)</span> </span>{
            jQuery.event.special[orig] = {
                delegateType: fix,
                bindType: fix,
                handle: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event)</span> </span>{
                    <span class="hljs-keyword">var</span> ret,
                        target = <span class="hljs-keyword">this</span>,
                        related = event.relatedTarget,
                        handleObj = event.handleObj;</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>For mousenter/leave call the handler if related is outside the target.
NB: No relatedTarget if the mouse left/entered the browser window</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (!related || (related !== target &amp;&amp; !jQuery.contains(target, related))) {
                        event.type = handleObj.origType;
                        ret = handleObj.handler.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
                        event.type = fix;
                    }
                    <span class="hljs-keyword">return</span> ret;
                }
            };
        });
    }

})(jQuery, <span class="hljs-built_in">window</span>, <span class="hljs-built_in">document</span>);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
