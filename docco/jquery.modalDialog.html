<!DOCTYPE html>  <html> <head>   <title>jquery.modalDialog.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="date-parse.html">                 date-parse.js               </a>                                           <a class="source" href="jquery.clientRect.html">                 jquery.clientRect.js               </a>                                           <a class="source" href="jquery.contentSize.html">                 jquery.contentSize.js               </a>                                           <a class="source" href="jquery.cookies.html">                 jquery.cookies.js               </a>                                           <a class="source" href="jquery.css.html">                 jquery.css.js               </a>                                           <a class="source" href="jquery.customEvent.html">                 jquery.customEvent.js               </a>                                           <a class="source" href="jquery.delimitedString.html">                 jquery.delimitedString.js               </a>                                           <a class="source" href="jquery.disableEvent.html">                 jquery.disableEvent.js               </a>                                           <a class="source" href="jquery.hostIframe.html">                 jquery.hostIframe.js               </a>                                           <a class="source" href="jquery.hoverDelay.html">                 jquery.hoverDelay.js               </a>                                           <a class="source" href="jquery.htmlEncode.html">                 jquery.htmlEncode.js               </a>                                           <a class="source" href="jquery.imageSize.html">                 jquery.imageSize.js               </a>                                           <a class="source" href="jquery.isVisibleKeyCode.html">                 jquery.isVisibleKeyCode.js               </a>                                           <a class="source" href="jquery.menu.html">                 jquery.menu.js               </a>                                           <a class="source" href="jquery-menu-exampleskin.html">                 jquery-menu-exampleskin.js               </a>                                           <a class="source" href="jquery.modalDialog.deviceFixes.html">                 jquery.modalDialog.deviceFixes.js               </a>                                           <a class="source" href="jquery.modalDialog.getSettings.html">                 jquery.modalDialog.getSettings.js               </a>                                           <a class="source" href="jquery.modalDialog.header.html">                 jquery.modalDialog.header.js               </a>                                           <a class="source" href="jquery.modalDialog.history.html">                 jquery.modalDialog.history.js               </a>                                           <a class="source" href="jquery.modalDialog.html">                 jquery.modalDialog.js               </a>                                           <a class="source" href="jquery.modalDialog.unobtrusive.html">                 jquery.modalDialog.unobtrusive.js               </a>                                           <a class="source" href="jquery.modalDialog.userAgent.html">                 jquery.modalDialog.userAgent.js               </a>                                           <a class="source" href="jquery.modalDialogContent.header.html">                 jquery.modalDialogContent.header.js               </a>                                           <a class="source" href="jquery.modalDialogContent.html">                 jquery.modalDialogContent.js               </a>                                           <a class="source" href="jquery.msAjax.html">                 jquery.msAjax.js               </a>                                           <a class="source" href="jquery.ns.html">                 jquery.ns.js               </a>                                           <a class="source" href="jquery.partialLoad.html">                 jquery.partialLoad.js               </a>                                           <a class="source" href="jquery.pointerEvents.html">                 jquery.pointerEvents.js               </a>                                           <a class="source" href="jquery.postMessage.html">                 jquery.postMessage.js               </a>                                           <a class="source" href="jquery.proxyAll.html">                 jquery.proxyAll.js               </a>                                           <a class="source" href="jquery.queryString.html">                 jquery.queryString.js               </a>                                           <a class="source" href="jquery.scrollAnchor.html">                 jquery.scrollAnchor.js               </a>                                           <a class="source" href="jquery.uncomment.html">                 jquery.uncomment.js               </a>                                           <a class="source" href="jquery.url.html">                 jquery.url.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs"><a href="../index.html">Home</a> | 
<a href="https://github.com/vistaprint/SkinnyJS/blob/master/js/jquery.modalDialog.js" target="_blank">View this file on Github</a>

<hr style="height: 1px; border:0; background-color:#4A525A">
             <h1>               jquery.modalDialog.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>TODO what to do with preventEventBubbling?</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span> <span class="o">&amp;&amp;</span> <span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">_isContent</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Attempt to load jquery.modalDialogContent.js in the same window as jquery.modalDialog.js.&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">MARGIN</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// @see MARGIN in jquery.modalDialog.less</span>
    <span class="kd">var</span> <span class="nx">STARTING_TOP</span> <span class="o">=</span> <span class="s2">&quot;-700px&quot;</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>A stack of dialogs in display order</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">_dialogStack</span> <span class="o">=</span> <span class="p">[];</span>

</pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>A map of dialogs by full ID</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">_fullIdMap</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="kd">var</span> <span class="nx">zIndex</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Default values</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">_defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="c1">// The title to display in the title bar of the dialog</span>
        <span class="nx">maxWidth</span><span class="o">:</span> <span class="mi">600</span><span class="p">,</span> <span class="c1">// Sets the maximum width of the dialog. Note that on small mobile devices, the actual width may be smaller, so you should design the dialog content accordingly</span>
        <span class="nx">initialHeight</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span> <span class="c1">// Only IFrameDialog uses this. Consider this internal for now.</span>
        <span class="nx">skin</span><span class="o">:</span> <span class="s2">&quot;primary&quot;</span><span class="p">,</span> <span class="c1">// The name of the skin to use for the dialog</span>
        <span class="nx">ajax</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// Determines how the url setting is interpreted. If true, the URL is the source for an AJAX dialog. If false, it will be the URL of an IFrame dialog</span>
        <span class="nx">url</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="c1">// The URL for the content of an IFrame or AJAX dialog</span>
        <span class="nx">content</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="c1">// A CSS selector or jQuery object for a content node to use for a node dialog</span>
        <span class="nx">destroyOnClose</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// If true, the dialog DOM will be destroyed and all events removed when the dialog closes</span>
        <span class="nx">containerElement</span><span class="o">:</span> <span class="s2">&quot;body&quot;</span><span class="p">,</span> <span class="c1">// A CSS selector or jQuery object for the element that should be the parent for the dialog DOM (useful for working with jQuery mobile)</span>
        <span class="nx">preventEventBubbling</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// If true, click and touch events are prevented from bubbling up to the document</span>
        <span class="nx">onopen</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">onclose</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">onbeforeopen</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">onbeforeclose</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">onajaxerror</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">enableHistory</span><span class="o">:</span> <span class="kc">true</span> <span class="c1">// If the history module is enabled, this can be used to disable history if set false</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>If the jquery.transit library is loaded, use CSS3 transitions instead of jQuery.animate()</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">_animateMethod</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">transition</span> <span class="o">?</span> <span class="s2">&quot;transition&quot;</span> <span class="o">:</span> <span class="s2">&quot;animate&quot;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">_easing</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">transition</span> <span class="o">?</span> <span class="s2">&quot;out&quot;</span> <span class="o">:</span> <span class="s2">&quot;swing&quot;</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">_ua</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">_ua</span><span class="p">;</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">iframeLoadTimeout</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">animationDuration</span> <span class="o">=</span> <span class="mi">600</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Class which creates a jQuery mobile dialog</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">ModalDialog</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">settings</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">settings</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">containerElement</span> <span class="o">||</span> <span class="s2">&quot;body&quot;</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Creates event objects on the dialog and copies handlers from settings</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">([</span><span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;beforeopen&quot;</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span> <span class="s2">&quot;beforeclose&quot;</span><span class="p">,</span> <span class="s2">&quot;ajaxerror&quot;</span><span class="p">],</span> <span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_setupCustomEvent</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>

</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Bind methods called as handlers so "this" works</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">$</span><span class="p">.</span><span class="nx">proxyAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;_drag&quot;</span><span class="p">,</span> <span class="s2">&quot;_startDrag&quot;</span><span class="p">,</span> <span class="s2">&quot;_stopDrag&quot;</span><span class="p">,</span> <span class="s2">&quot;_close&quot;</span><span class="p">,</span> <span class="s2">&quot;_keydownHandler&quot;</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dialogType</span> <span class="o">=</span> <span class="s2">&quot;node&quot;</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Creates a custom event on this object with the specified event name</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_setupCustomEvent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">onEvent</span> <span class="o">=</span> <span class="s2">&quot;on&quot;</span> <span class="o">+</span> <span class="nx">eventName</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">evt</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">CustomEvent</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">handler</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">[</span><span class="nx">onEvent</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">handler</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">evt</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">handler</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">evt</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_initDeferred</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">action</span><span class="p">,</span> <span class="nx">deferred</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_deferreds</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_deferreds</span> <span class="o">||</span> <span class="p">{};</span>
        <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">deferred</span> <span class="o">||</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_deferreds</span><span class="p">[</span><span class="nx">action</span><span class="p">]</span> <span class="o">=</span> <span class="nx">deferred</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">deferred</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_completeDeferred</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">action</span><span class="p">,</span> <span class="nx">resolution</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_deferreds</span><span class="p">[</span><span class="nx">action</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">deferred</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">deferred</span><span class="p">[</span><span class="nx">resolution</span> <span class="o">+</span> <span class="s2">&quot;With&quot;</span><span class="p">](</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>this._deferreds[action] = null;</p>             </td>             <td class="code">               <div class="highlight"><pre>

            <span class="k">return</span> <span class="nx">deferred</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;No deferred initialized for action &#39;&quot;</span> <span class="o">+</span> <span class="nx">action</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_resolveDeferred</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">action</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_completeDeferred</span><span class="p">(</span><span class="nx">action</span><span class="p">,</span> <span class="s2">&quot;resolve&quot;</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_rejectDeferred</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">action</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_completeDeferred</span><span class="p">(</span><span class="nx">action</span><span class="p">,</span> <span class="s2">&quot;reject&quot;</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_clearDeferred</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_deferreds</span><span class="p">[</span><span class="nx">action</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_getDeferred</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_deferreds</span><span class="p">[</span><span class="nx">action</span><span class="p">];</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_isDeferredComplete</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getDeferred</span><span class="p">(</span><span class="nx">action</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">!</span><span class="nx">deferred</span> <span class="o">||</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">state</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;pending&quot;</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isOpen</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="o">!!</span><span class="k">this</span><span class="p">.</span><span class="nx">_open</span><span class="p">;</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Opens the dialog</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">open</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_initDeferred</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="nx">deferred</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Ensure the dialog doesn't open once its already opened.. 
Otherwise, you could end up pushing it on to the stack more than once.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_open</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_rejectDeferred</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">);</span>
        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Description</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">level</span> <span class="o">=</span> <span class="nx">_dialogStack</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Fire onbeforeopen on this instance</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="kd">var</span> <span class="nx">evt</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">onbeforeopen</span><span class="p">.</span><span class="nx">fire</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">isDefaultPrevented</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_rejectDeferred</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">);</span>
        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Fire onbeforeopen globally</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">evt</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">onbeforeopen</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">isDefaultPrevented</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_rejectDeferred</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">);</span>
        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Keep track of the dialog stacking order</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">_dialogStack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">_open</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">_build</span><span class="p">();</span>

</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>add or remove the 'smallscreen' class (which can also be checked using CSS media queries)</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">[</span><span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">isSmallScreen</span><span class="p">()</span> <span class="o">?</span> <span class="s2">&quot;addClass&quot;</span> <span class="o">:</span> <span class="s2">&quot;removeClass&quot;</span> <span class="p">](</span><span class="s2">&quot;smallscreen&quot;</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Stop any animations on the container</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">.</span><span class="nx">stop</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">_showLoadingIndicator</span><span class="p">();</span>

        <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;keydown&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_keydownHandler</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">_finishOpenAction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">deferred</span><span class="p">.</span><span class="nx">state</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;rejected&quot;</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$bg</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">veilClass</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Set the width first so that heights can be calculated based
on the layout for that width.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="kd">var</span> <span class="nx">widthData</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getDefaultWidthData</span><span class="p">();</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span> <span class="nx">width</span><span class="o">:</span> <span class="nx">widthData</span><span class="p">.</span><span class="nx">width</span> <span class="p">});</span>

                <span class="kd">var</span> <span class="nx">initialPos</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getDefaultPosition</span><span class="p">();</span>
                <span class="kd">var</span> <span class="nx">initialTop</span> <span class="o">=</span> <span class="nx">initialPos</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
                <span class="nx">initialPos</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">STARTING_TOP</span><span class="p">;</span> <span class="c1">// we&#39;re going to animate this to slide down</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="nx">initialPos</span><span class="p">);</span>

                <span class="kd">var</span> <span class="nx">animationCallback</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span>
                <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;dialog-visible&quot;</span><span class="p">);</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">isSmallScreen</span><span class="p">())</span>
                    <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>TODO: I question this change. Should it be decoupled from the dialog framework?
It could be put into mobile fixes.
Is this even mobile specific?
Original comment:
Force dialogs that are on small screens to trigger a window resize event when closed, just in case we have resized since the dialog opened.</p>             </td>             <td class="code">               <div class="highlight"><pre>

                        <span class="k">this</span><span class="p">.</span><span class="nx">triggerWindowResize</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">_orientationchange</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> 
                            <span class="p">{</span>
                                <span class="k">this</span><span class="p">.</span><span class="nx">triggerWindowResize</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                                <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
                            <span class="p">},</span> 
                            <span class="k">this</span><span class="p">);</span>

                        <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;orientationchange resize&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_orientationchange</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">this</span><span class="p">.</span><span class="nx">onopen</span><span class="p">.</span><span class="nx">fire</span><span class="p">();</span>

                    <span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">onopen</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

                    <span class="k">this</span><span class="p">.</span><span class="nx">_resolveDeferred</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">);</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">_clearDeferred</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">);</span>

                <span class="p">},</span> <span class="k">this</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Animate with a CSS transition if possible,
otherwise, fallback on a jquery animation</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">[</span><span class="nx">_animateMethod</span><span class="p">]({</span> <span class="nx">top</span><span class="o">:</span> <span class="nx">initialTop</span> <span class="p">},</span> <span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">animationDuration</span><span class="p">,</span> <span class="nx">_easing</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">promise</span><span class="p">()</span>
                    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">animationCallback</span><span class="p">,</span> <span class="nx">animationCallback</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">_clearDeferred</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">_hideLoadingIndicator</span><span class="p">();</span>
        <span class="p">};</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">_finishOpen</span><span class="p">();</span>

        <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">();</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_finishOpen</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_finishOpenAction</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_finishOpenAction</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_finishOpenAction</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>If a user hits the ESC key, close the dialog or cancel it's opening.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_keydownHandler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="mi">27</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">getCurrent</span><span class="p">()</span> <span class="o">===</span> <span class="k">this</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">cancel</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">cancel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Don't move to the end state of the animation:
stop it right where it is.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">.</span><span class="nx">stop</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isOpen</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_showLoadingIndicator</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">$loadingIndicator</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$loadingIndicator</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;div class=&#39;dialog-loading-indicator&#39;&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt;&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$bg</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;z-index&quot;</span><span class="p">,</span> <span class="nb">parseInt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$bg</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;z-index&quot;</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_hideLoadingIndicator</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$loadingIndicator</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$loadingIndicator</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_popDialogStack</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">getCurrent</span><span class="p">()</span> <span class="o">===</span> <span class="k">this</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">_dialogStack</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Closes the dialog. 
isDialogCloseButton Indicates the cancel button in the dialog's header was clicked.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">close</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">isDialogCloseButton</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_initDeferred</span><span class="p">(</span><span class="s2">&quot;close&quot;</span><span class="p">,</span> <span class="nx">deferred</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">getCurrent</span><span class="p">()</span> <span class="o">!==</span> <span class="k">this</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Can&#39;t close a dialog that isn&#39;t currently displayed on top.&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">eventSettings</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">isDialogCloseButton</span><span class="o">:</span> <span class="o">!!</span><span class="nx">isDialogCloseButton</span> <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Expose an event allowing consumers to cancel the close event</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onbeforeclose</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">eventSettings</span><span class="p">).</span><span class="nx">isDefaultPrevented</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_rejectDeferred</span><span class="p">(</span><span class="s2">&quot;close&quot;</span><span class="p">);</span>
        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Expose a global event</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">onbeforeclose</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">eventSettings</span><span class="p">,</span> <span class="k">this</span><span class="p">).</span><span class="nx">isDefaultPrevented</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_rejectDeferred</span><span class="p">(</span><span class="s2">&quot;close&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">_popDialogStack</span><span class="p">();</span>

        <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">off</span><span class="p">(</span><span class="s2">&quot;keydown&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_keydownHandler</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;dialog-visible&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">[</span><span class="nx">_animateMethod</span><span class="p">](</span>
            <span class="p">{</span><span class="nx">top</span><span class="o">:</span> <span class="nx">STARTING_TOP</span><span class="p">},</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">animationDuration</span><span class="p">,</span>
            <span class="nx">_easing</span><span class="p">,</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_finishClose</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="nx">eventSettings</span><span class="p">)</span>
        <span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>unbind global event listeners</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_orientationchange</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">off</span><span class="p">(</span><span class="s2">&quot;orientationchange resize&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_orientationchange</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">();</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_close</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">close</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_reset</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_open</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">.</span><span class="nx">stop</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span> <span class="nx">top</span><span class="o">:</span> <span class="nx">STARTING_TOP</span> <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$bg</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">veilClass</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_resetFailed</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_reset</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_popDialogStack</span><span class="p">();</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_finishClose</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_reset</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">destroyOnClose</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_destroy</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_destroyed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">delete</span> <span class="nx">_fullIdMap</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">_fullId</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">isSmallScreen</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">triggerWindowResize</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;resize&quot;</span><span class="p">);</span>
        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Fire events on a timeout so that the event loop
has a chance to process DOM changes. 
Without this, close handlers can't re-open the same iframe dialog:
the iframe isn't recognized as a new element.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">setTimeout</span><span class="p">(</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">onclose</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>

                <span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">onclose</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

                <span class="k">this</span><span class="p">.</span><span class="nx">_resolveDeferred</span><span class="p">(</span><span class="s2">&quot;close&quot;</span><span class="p">);</span>
            <span class="p">},</span> <span class="k">this</span><span class="p">),</span> 
            <span class="mi">0</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_destroy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Put the content node back on the body.
It could be used again.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">$content</span><span class="p">.</span><span class="nx">detach</span><span class="p">().</span><span class="nx">appendTo</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Builds the DOM for the dialog chrome</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_build</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="cm">/*jshint quotmark:false*/</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_destroyed</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;This dialog has been destroyed&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$bg</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;dialog-background&quot;&gt;&lt;/div&gt;&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;z-index&#39;</span><span class="p">,</span> <span class="o">++</span><span class="nx">zIndex</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>increase the z-index again to consider the loading indicator</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="nx">zIndex</span><span class="o">++</span><span class="p">;</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">$container</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span>
                <span class="s1">&#39;&lt;div class=&quot;dialog-container&quot; id=&quot;&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">_fullId</span> <span class="o">+</span> <span class="s1">&#39;Container&quot;&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;  &lt;div class=&quot;dialog-header&quot;&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;    &lt;a href=&quot;#&quot; class=&quot;dialog-close-button&quot;&gt;&lt;span class=&quot;dialog-close-button-icon&quot;&gt;&lt;/span&gt;&lt;/a&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;    &lt;h1&gt;&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s1">&#39;&lt;/h1&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;  &lt;/div&gt;&#39;</span><span class="o">+</span>
                <span class="s1">&#39;  &lt;div class=&quot;dialog-content-container&quot;&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;  &lt;/div&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;&lt;/div&gt;&#39;</span>
            <span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;z-index&#39;</span><span class="p">,</span> <span class="o">++</span><span class="nx">zIndex</span><span class="p">);</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">$el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">([</span><span class="k">this</span><span class="p">.</span><span class="nx">$bg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">[</span><span class="mi">0</span><span class="p">]]).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;dialog-skin-&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">skin</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>HACK: Support jQuery mobile. In jQuery mobile, the root element needs to be specific.
TODO: Move this to a jQuery mobile fixes specific module</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$bg</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;ui-page-active&quot;</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$bg</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="s2">&quot;absolute&quot;</span><span class="p">);</span>

                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;static&quot;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="s2">&quot;relative&quot;</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">$contentContainer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.dialog-content-container&quot;</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$header</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.dialog-header&quot;</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$closeButton</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.dialog-close-button&quot;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_close</span><span class="p">);</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">_buildContent</span><span class="p">();</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">$content</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;*[data-action=&quot;close&quot;]&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_close</span><span class="p">);</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">$contentContainer</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$content</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>only enable dragging if the dialog is over the entire window
and we are not in Internet Explorer 7, because it handles positioning oddly.</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="k">if</span> <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;ui-page-active&quot;</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">_ua</span><span class="p">.</span><span class="nx">ie7</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">_makeDraggable</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_alreadyBuilt</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Subclasses should override to do something when a cached DOM is used</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_alreadyBuilt</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>noop</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_getChromeHeight</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_chromeHeight</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_chromeHeight</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">$content</span><span class="p">.</span><span class="nx">height</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_chromeHeight</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_getDefaultWidthData</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">$win</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">windowWidth</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span> <span class="o">||</span> <span class="nx">$win</span><span class="p">.</span><span class="nx">width</span><span class="p">())</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">width</span><span class="p">();</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="nx">windowWidth</span><span class="o">:</span> <span class="nx">windowWidth</span><span class="p">,</span>
            <span class="nx">width</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">windowWidth</span> <span class="o">-</span> <span class="p">(</span><span class="nx">MARGIN</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span> <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">maxWidth</span><span class="p">)</span>
        <span class="p">};</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_getDefaultPosition</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">contentHeight</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">widthData</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getDefaultWidthData</span><span class="p">();</span>

        <span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> 
        <span class="p">{</span>
            <span class="nx">width</span><span class="o">:</span> <span class="nx">widthData</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
            <span class="nx">top</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">scrollTop</span><span class="p">()</span> <span class="o">+</span> <span class="nx">MARGIN</span>
        <span class="p">};</span>

        <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="p">(</span><span class="nx">widthData</span><span class="p">.</span><span class="nx">windowWidth</span> <span class="o">-</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">isSmallScreen</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">isSmallScreen</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">_ua</span><span class="p">.</span><span class="nx">ie7</span> <span class="o">||</span> <span class="nx">isSmallScreen</span><span class="p">)</span> <span class="c1">// TODO why IE7?</span>
        <span class="p">{</span>
            <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">MARGIN</span><span class="p">;</span>
        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>For small mobile devices, always position at the top.
No need to consider contentHeight.
For larger devices, center vertically.</p>             </td>             <td class="code">               <div class="highlight"><pre>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isSmallScreen</span><span class="p">)</span> 
        <span class="p">{</span>
            <span class="nx">contentHeight</span> <span class="o">=</span> <span class="nx">contentHeight</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">$content</span><span class="p">.</span><span class="nx">height</span><span class="p">();</span>

</pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Get the new container height with the proposed content height</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="kd">var</span> <span class="nx">containerHeight</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getChromeHeight</span><span class="p">()</span> <span class="o">+</span> <span class="nx">contentHeight</span><span class="p">;</span>

            <span class="kd">var</span> <span class="nx">parentHeight</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">height</span><span class="p">()</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">height</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">idealTop</span> <span class="o">=</span> <span class="p">(</span><span class="nx">parentHeight</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">containerHeight</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>

            <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">idealTop</span><span class="p">,</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">pos</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_makeDraggable</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Small devices shouldn't have the dialog be draggable.
Where you gonna drag to?</p>             </td>             <td class="code">               <div class="highlight"><pre>

        <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">isSmallScreen</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">$header</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;draggable&quot;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;pointerdown&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_startDrag</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_startDrag</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">$target</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Don't drag if the close button is being clicked</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">$target</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$closeButton</span><span class="p">)</span> <span class="o">||</span> <span class="nx">$target</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$closeButton</span><span class="p">.</span><span class="nx">children</span><span class="p">()))</span>
        <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">_initialMousePos</span> <span class="o">=</span> <span class="nx">getMousePos</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_initialDialogPos</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">.</span><span class="nx">offset</span><span class="p">();</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">$bg</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;pointermove&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_drag</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;pointermove&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_drag</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>make sure the mouseup also works on the background</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">$bg</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;pointerup&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_stopDrag</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>chrome node is the last element that can handle events- it has cancel bubble set</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;pointerup&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_stopDrag</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$frame</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$frame</span><span class="p">.</span><span class="nx">iframeDocument</span><span class="p">().</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;pointermove&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_drag</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;pointerup&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_stopDrag</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="nx">ex</span><span class="p">)</span>
            <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>This can fail if the frame is in another domain</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">_parentRect</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">clientRect</span><span class="p">();</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">_isDragging</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_drag</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>

        <span class="kd">var</span> <span class="nx">mousePos</span> <span class="o">=</span> <span class="nx">getMousePos</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">deltaTop</span> <span class="o">=</span> <span class="nx">mousePos</span><span class="p">.</span><span class="nx">top</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_initialMousePos</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">deltaLeft</span> <span class="o">=</span> <span class="nx">mousePos</span><span class="p">.</span><span class="nx">left</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_initialMousePos</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">newPos</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">top</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_initialDialogPos</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">deltaTop</span><span class="p">,</span>
            <span class="nx">left</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_initialDialogPos</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">deltaLeft</span>
        <span class="p">};</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="nx">newPos</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_stopDrag</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_initialMousePos</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_initialDialogPos</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

        <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

</pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Remove the drag events</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">$bg</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="s2">&quot;pointermove&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_drag</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="s2">&quot;pointermove&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_drag</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">$bg</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="s2">&quot;pointerup&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_stopDrag</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="s2">&quot;pointerup&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_stopDrag</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$frame</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$frame</span><span class="p">.</span><span class="nx">iframeDocument</span><span class="p">().</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="s2">&quot;pointermove&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_drag</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="s2">&quot;pointerup&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_stopDrag</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="nx">ex</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">_isDragging</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Gets the current mouse position from the event object.
returns an object with top and left</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">getMousePos</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">mousePos</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">left</span><span class="o">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span>
            <span class="nx">top</span><span class="o">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span>
        <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>Translate event positions from a nested iframe</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">ownerDocument</span> <span class="o">!=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">$iframe</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">ownerDocument</span><span class="p">).</span><span class="nx">hostIframe</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">$iframe</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">rect</span> <span class="o">=</span> <span class="nx">$iframe</span><span class="p">.</span><span class="nx">clientRect</span><span class="p">();</span>
                <span class="nx">mousePos</span><span class="p">.</span><span class="nx">top</span> <span class="o">+=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
                <span class="nx">mousePos</span><span class="p">.</span><span class="nx">left</span> <span class="o">+=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">mousePos</span><span class="p">;</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Builds the DOM for the content node.
Should be overridden by subclasses.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_buildContent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$content</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">content</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$content</span><span class="p">.</span><span class="nx">detach</span><span class="p">();</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Gets a reference to the current window.
This will be overriden by an iframe dialog.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getWindow</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">window</span><span class="p">;</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Gets a reference to the dialog that opened this dialog.
This is null if the dialog was opened by the main window.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getParent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">parentId</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nx">getDialog</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">parentId</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Sets the height of the content in pixels.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">center</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getDefaultPosition</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">[</span><span class="nx">_animateMethod</span><span class="p">]({</span> <span class="nx">top</span><span class="o">:</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="p">},</span> <span class="mi">400</span><span class="p">);</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Reposition the dialog to the correct position.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pos</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">animate</span><span class="p">)</span>
    <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>stop any currently running animations</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">.</span><span class="nx">stop</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getDefaultPosition</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">animate</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">top</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
            <span class="k">delete</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="nx">pos</span><span class="p">)[</span><span class="nx">_animateMethod</span><span class="p">]({</span> <span class="nx">top</span><span class="o">:</span> <span class="nx">top</span> <span class="p">},</span> <span class="mi">400</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="nx">pos</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Sets the title of the dialog in the header.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setTitle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">title</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.dialog-header h1&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">title</span><span class="p">);</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>Gets the title of the dialog in the header.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getTitle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$container</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.dialog-header h1&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>Extends ModalDialog such that the content is an iframe.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">IFrameDialog</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">parentId</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_parentWindow</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">frames</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">parentId</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">IFrameDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>

    <span class="nx">IFrameDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dialogType</span> <span class="o">=</span> <span class="s2">&quot;iframe&quot;</span><span class="p">;</span>

    <span class="nx">IFrameDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_setupCustomEvent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">evt</span> <span class="o">=</span> <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_setupCustomEvent</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="nx">evt</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">_crossWindowEventHandler</span><span class="p">);</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Broadcasts events to all active dialogs so any window that has a proxy for the dialog can be notified.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">_crossWindowEventHandler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
    <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>"this" is the dialog</p>             </td>             <td class="code">               <div class="highlight"><pre>

        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">_dialogStack</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">_dialogStack</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">_postCommand</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nx">_dialogStack</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">_postCommand</span><span class="p">(</span><span class="s2">&quot;event&quot;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span> <span class="nx">_eventDialogId</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">_fullId</span><span class="p">},</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>Override the _buildContent method to construct an iframe</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">IFrameDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_finishClose</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_finishClose</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">$frame</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
    <span class="p">};</span>

    <span class="nx">IFrameDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_destroy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>Override the _buildContent method to construct an iframe</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">IFrameDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_buildContent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="cm">/* jshint quotmark:false */</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">_iframeLoadTimer</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$frame</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">$frame</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$frame</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">$frame</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;iframe src=&quot;&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">url</span> <span class="o">+</span> 
            <span class="s1">&#39;&quot; name=&quot;&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">_fullId</span> <span class="o">+</span> 
            <span class="s1">&#39;&quot; seamless allowtransparency=&quot;true&quot; width=&quot;100%&quot; style=&quot;height:&#39;</span> <span class="o">+</span> 
            <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">initialHeight</span> <span class="o">+</span> <span class="s1">&#39;px;&quot; class=&quot;dialog-frame&quot; scrolling=&quot;no&quot; frameborder=&quot;0&quot; framespacing=&quot;0&quot;&gt;&lt;/iframe&gt;&#39;</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">iframeLoadTimeout</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>When the iframe loads, even if its a failed status (i.e. 404), the load event will fire.
We expect that the dialog will call notifyReady(). If it doesn't, this timeout will
eventually fire, causing the open() promise to be rejected, and the dialog state to be cleaned up.</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="k">this</span><span class="p">.</span><span class="nx">$frame</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span>
                <span class="s2">&quot;load&quot;</span><span class="p">,</span> 
                <span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> 
                <span class="p">{</span> 
</pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>The "open" promise has already been resolved: don't continue setting a timeout.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_isDeferredComplete</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">))</span>
                    <span class="p">{</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>The iframe has $.modalDialog.iframeLoadTimeout milliseconds to call notifyReady() after the load event is called.
Otherwise, the "open" promise will be rejected.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="k">this</span><span class="p">.</span><span class="nx">_iframeLoadTimer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span>
                        <span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> 
                        <span class="p">{</span> 
                            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_isDeferredComplete</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">))</span>
                            <span class="p">{</span>
                                <span class="k">return</span><span class="p">;</span>
                            <span class="p">}</span>

                            <span class="k">this</span><span class="p">.</span><span class="nx">$frame</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
                            <span class="k">this</span><span class="p">.</span><span class="nx">_resetFailed</span><span class="p">();</span>

                            <span class="k">this</span><span class="p">.</span><span class="nx">_rejectDeferred</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="p">[{</span> <span class="nx">message</span><span class="o">:</span> <span class="s2">&quot;iframe load timeout for url: &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">url</span> <span class="p">}]);</span>

                        <span class="p">},</span> <span class="k">this</span><span class="p">),</span>
                        <span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">iframeLoadTimeout</span>
                        <span class="p">);</span>
                <span class="p">},</span> 
                <span class="k">this</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">$content</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$frame</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nx">IFrameDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_alreadyBuilt</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_buildContent</span><span class="p">();</span>

</pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>TODO Need to somehow notify the dialog content that it should fire notifyReady</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">$contentContainer</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$content</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">IFrameDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getWindow</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$frame</span><span class="p">.</span><span class="nx">iframeWindow</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>Sends a message to the iframe content window. 
Used for orchestrating cross-window communication with dialog proxies.
* {string} command: The name of the command to send to the content window
* {object} data: A simple data object to serialize (as a querystring) and send with the command</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">IFrameDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_postCommand</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">command</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">messageData</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">dialogCmd</span><span class="o">:</span> <span class="nx">command</span> <span class="p">};</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">messageData</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="nx">messageData</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>Sends a message to the iframe content window. 
Used for orchestrating cross-window communication with dialog proxies.
* {string} command: The name of the command to send to the content window
* {object} data: A simple data object to serialize (as a querystring) and send with the command</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">IFrameDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">postMessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">win</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getWindow</span><span class="p">();</span>

        <span class="kd">var</span> <span class="nx">hostname</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">frameHostname</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hostname</span><span class="p">)</span>
        <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>Get the domain of the target window. If the URL is relative, its the same as the current page.</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="nx">hostname</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">url</span> <span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">hostname</span><span class="p">,</span> <span class="nx">win</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="nx">win</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">IFrameDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setHeight</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">contentHeight</span><span class="p">,</span> <span class="nx">center</span><span class="p">,</span> <span class="nx">skipAnimation</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">applyChange</span> <span class="o">=</span> <span class="nx">skipAnimation</span> <span class="o">?</span> 
            <span class="kd">function</span><span class="p">(</span><span class="nx">$content</span><span class="p">,</span> <span class="nx">css</span><span class="p">)</span> <span class="p">{</span> <span class="nx">$content</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="nx">css</span><span class="p">);</span> <span class="p">}</span> <span class="o">:</span>
            <span class="kd">function</span><span class="p">(</span><span class="nx">$content</span><span class="p">,</span> <span class="nx">css</span><span class="p">)</span> <span class="p">{</span> <span class="nx">$content</span><span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="nx">css</span><span class="p">,</span> <span class="p">{</span> <span class="nx">duration</span><span class="o">:</span> <span class="mi">400</span> <span class="p">});</span> <span class="p">};</span>

        <span class="nx">applyChange</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$content</span><span class="p">,</span> <span class="p">{</span> <span class="nx">height</span><span class="o">:</span> <span class="nx">contentHeight</span> <span class="p">});</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">center</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getDefaultPosition</span><span class="p">(</span><span class="nx">contentHeight</span><span class="p">);</span>
            <span class="nx">applyChange</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$content</span><span class="p">,</span> <span class="p">{</span> <span class="nx">top</span><span class="o">:</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="p">});</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">initialHeight</span> <span class="o">=</span> <span class="nx">contentHeight</span><span class="p">;</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>Sets the height of the iframe to the detected height of the iframe content document.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">IFrameDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setHeightFromContent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">center</span><span class="p">,</span> <span class="nx">skipAnimation</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_postCommand</span><span class="p">(</span><span class="s2">&quot;setHeightFromContent&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">center</span><span class="o">:</span> <span class="o">!!</span><span class="nx">center</span><span class="p">,</span> <span class="nx">skipAnimation</span><span class="o">:</span> <span class="o">!!</span><span class="nx">skipAnimation</span><span class="p">});</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>Sets the title of the dialog in the header from the HTML title tag of the iframe content document.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">IFrameDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setTitleFromContent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_postCommand</span><span class="p">(</span><span class="s2">&quot;setTitleFromContent&quot;</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">IFrameDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">notifyReady</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">hostname</span><span class="p">)</span>
    <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>There may be a timer waiting for the iframe to load- cancel it.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_iframeLoadTimer</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">clearTimeout</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_iframeLoadTimer</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_iframeLoadTimer</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">frameHostname</span> <span class="o">=</span> <span class="nx">hostname</span><span class="p">;</span>

        <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_finishOpen</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">IFrameDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_finishOpen</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>AjaxDialog: Extends ModalDialog 
Loads content via ajax</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">AjaxDialog</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">AjaxDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>

    <span class="nx">AjaxDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dialogType</span> <span class="o">=</span> <span class="s2">&quot;ajax&quot;</span><span class="p">;</span>

    <span class="nx">AjaxDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">open</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">open</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_ajaxComplete</span><span class="p">)</span>
        <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>$.fn.partialLoad will ajax in content intelligently,
adding scripts, but not if they're already loaded.</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="k">this</span><span class="p">.</span><span class="nx">$content</span><span class="p">.</span><span class="nx">partialLoad</span><span class="p">(</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
                <span class="kc">null</span><span class="p">,</span>
                <span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span>
                    <span class="kd">function</span><span class="p">(</span><span class="nx">responseText</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">xhr</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">_ajaxComplete</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

                        <span class="nx">xhr</span><span class="p">.</span><span class="nx">fail</span><span class="p">(</span>
                            <span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span>
                            <span class="p">{</span>
                                <span class="k">this</span><span class="p">.</span><span class="nx">_resetFailed</span><span class="p">();</span>

                                <span class="kd">var</span> <span class="nx">errEvent</span> <span class="o">=</span> <span class="p">{</span> 
                                    <span class="nx">xhr</span><span class="o">:</span> <span class="nx">xhr</span><span class="p">,</span> 
                                    <span class="nx">status</span><span class="o">:</span> <span class="nx">status</span><span class="p">,</span> 
                                    <span class="nx">responseText</span><span class="o">:</span> <span class="nx">responseText</span>
                                <span class="p">};</span>

                                <span class="k">this</span><span class="p">.</span><span class="nx">onajaxerror</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">errEvent</span><span class="p">);</span>

                                <span class="k">this</span><span class="p">.</span><span class="nx">_rejectDeferred</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">errEvent</span><span class="p">]);</span>

                            <span class="p">},</span> <span class="k">this</span><span class="p">));</span>

</pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>Extract title from content if not explicitly specified</p>             </td>             <td class="code">               <div class="highlight"><pre>
                        <span class="kd">var</span> <span class="nx">$title</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$content</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">);</span>
                        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">title</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">$title</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
                            <span class="p">{</span>
                                <span class="k">this</span><span class="p">.</span><span class="nx">setTitle</span><span class="p">(</span><span class="nx">$title</span><span class="p">.</span><span class="nx">text</span><span class="p">());</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                        <span class="nx">$title</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>

                        <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_finishOpen</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
                    <span class="p">},</span> 
                    <span class="k">this</span><span class="p">)</span>
                <span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>The content is already loaded</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="nx">ModalDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_finishOpen</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">();</span>
    <span class="p">};</span>

    <span class="nx">AjaxDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_finishOpen</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>no-op. Needds to wait for content to be ajaxed in asynchronously.
Base implementation will be called manually.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="p">};</span>

    <span class="nx">AjaxDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_buildContent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>Create a container and ajax content into it.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">$content</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;div class=&#39;dialog-content&#39;&gt;&lt;/div&gt;&quot;</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">AjaxDialog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_destroy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
    <span class="p">};</span>

    <span class="kd">var</span> <span class="nx">_dialogIdCounter</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">DIALOG_NAME_PREFIX</span> <span class="o">=</span> <span class="s2">&quot;dialog&quot;</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>Determines if the specified string is a CSS selector or a URL.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">isSelector</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">firstChar</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">firstChar</span> <span class="o">==</span> <span class="s2">&quot;#&quot;</span><span class="p">)</span>
        <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>This is a #anchor
Its a selector</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>Selectors never contain /
This is a URL</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">firstChar</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">secondChar</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">secondChar</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span> <span class="o">||</span> <span class="nx">secondChar</span> <span class="o">==</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>Starts with .. or ./
This is a URL, not a selector</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>It's a CSS class:
.foo</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>We can't determine. Presume this is a URL.
i.e. "something" or "something.something" can be a either URL or a selector</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>Takes a settings object and calculates derived settings.
Settings go in order:</p>             </td>             <td class="code">               <div class="highlight"><pre>

</pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <ol>
<li>default value</li>
<li>setting provided on content element</li>
<li>settings passed</li>
</ol>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">ensureSettings</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">explicitSettings</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">settings</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">_defaults</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>An iframe dialog may have sent a reference to dialog content,
but it didn't know if it was a URL or a selector for a DOM node.
Determine which it is.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">explicitSettings</span><span class="p">.</span><span class="nx">contentOrUrl</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">isSelector</span><span class="p">(</span><span class="nx">explicitSettings</span><span class="p">.</span><span class="nx">contentOrUrl</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="nx">explicitSettings</span><span class="p">.</span><span class="nx">content</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">explicitSettings</span><span class="p">.</span><span class="nx">contentOrUrl</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="nx">explicitSettings</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">explicitSettings</span><span class="p">.</span><span class="nx">contentOrUrl</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">delete</span> <span class="nx">explicitSettings</span><span class="p">.</span><span class="nx">contentOrUrl</span><span class="p">;</span>
        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>Read settings specified on the target node's custom HTML attributes</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">explicitSettings</span><span class="p">.</span><span class="nx">content</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">$target</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">explicitSettings</span><span class="p">.</span><span class="nx">content</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">targetSettings</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">getSettings</span><span class="p">(</span><span class="nx">$target</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">settings</span><span class="p">,</span> <span class="nx">targetSettings</span><span class="p">);</span>
        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>The explicitly specified settings take precedence</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">settings</span><span class="p">,</span> <span class="nx">explicitSettings</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">id</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>A fullId was specified, passed from an existing dialog's content window via a message. 
Calculate the parentId from the fullId.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">_fullId</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">idParts</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">_fullId</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">);</span>
            <span class="nx">id</span> <span class="o">=</span> <span class="nx">idParts</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">idParts</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nx">settings</span><span class="p">.</span><span class="nx">parentId</span> <span class="o">=</span> <span class="nx">idParts</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>Ensure a unique ID for the dialog</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="nx">id</span> <span class="o">=</span> <span class="nx">DIALOG_NAME_PREFIX</span> <span class="o">+</span> <span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">id</span> <span class="o">||</span> <span class="o">++</span><span class="nx">_dialogIdCounter</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>If a parentId was specified, this is a new dialog being created from 
a child dialog. The child will become the "parent dialog" of the new dialog.</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="kd">var</span> <span class="nx">parentId</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">parentId</span> <span class="o">?</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">parentId</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

            <span class="nx">settings</span><span class="p">.</span><span class="nx">_fullId</span> <span class="o">=</span> <span class="nx">parentId</span> <span class="o">+</span> <span class="nx">id</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">settings</span><span class="p">;</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>Gets the dialog by the fullId.</p>             </td>             <td class="code">               <div class="highlight"><pre>

</pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <ul>
<li>{string} fullId The full ID of the dialog (including all parent ids)</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">getDialog</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fullId</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_fullIdMap</span><span class="p">[</span><span class="nx">fullId</span><span class="p">];</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>Public sub-namespace for modal dialogs.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span> <span class="o">||</span> <span class="p">{};</span>

</pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>Used to prevent the content window script from loading over this one</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">_isHost</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>On small screens we make the background opaque to hide the content because
we will be hiding all content within the DOM and scrolling them to top.
When removing the host window content from the DOM, make the veil opaque to hide it.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">veilClass</span> <span class="o">=</span> <span class="s2">&quot;dialog-veil&quot;</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>Creates a new dialog from the specified settings.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">create</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">settings</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">settings</span> <span class="o">=</span> <span class="nx">ensureSettings</span><span class="p">(</span><span class="nx">settings</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">dialog</span> <span class="o">=</span> <span class="nx">getDialog</span><span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">_fullId</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p>Validate that there isn't an existing dialog open using the same content</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">dialog</span> <span class="o">&amp;&amp;</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">content</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">existingDialog</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">content</span><span class="p">).</span><span class="nx">modalDialogInstance</span><span class="p">();</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">existingDialog</span> <span class="o">&amp;&amp;</span> 
                <span class="nx">settings</span><span class="p">.</span><span class="nx">_fullId</span> <span class="o">&amp;&amp;</span> 
                <span class="nx">existingDialog</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">_fullId</span> <span class="o">!==</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">_fullId</span> <span class="o">&amp;&amp;</span> 
                <span class="nx">existingDialog</span><span class="p">.</span><span class="nx">isOpen</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;An attempt was made to create a dialog with a content node which is already assigned to another open dialog.&quot;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">dialog</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">url</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">content</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Both url and content cannot be specified.&quot;</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">ajax</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="nx">dialog</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AjaxDialog</span><span class="p">(</span><span class="nx">settings</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="nx">dialog</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">IFrameDialog</span><span class="p">(</span><span class="nx">settings</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">content</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">content</span><span class="p">).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;ModalDialog content not found&quot;</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="nx">dialog</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ModalDialog</span><span class="p">(</span><span class="nx">settings</span><span class="p">);</span>

                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">settings</span><span class="p">.</span><span class="nx">destroyOnClose</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="nx">$</span><span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">content</span><span class="p">).</span><span class="nx">modalDialogInstance</span><span class="p">(</span><span class="nx">dialog</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;No url or content node specified&quot;</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="nx">_fullIdMap</span><span class="p">[</span><span class="nx">settings</span><span class="p">.</span><span class="nx">_fullId</span><span class="p">]</span> <span class="o">=</span> <span class="nx">dialog</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">dialog</span><span class="p">;</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p>Gets the currently active dialog (topmost visually).</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">getCurrent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_dialogStack</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">_dialogStack</span><span class="p">[</span><span class="nx">_dialogStack</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>Gets an existing dialog if it's settings match the specified setting's content node or URL</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">getExisting</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">settings</span><span class="p">)</span>
    <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>Supresses warnings about using !! to coerce a falsy value to boolean</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="cm">/* jshint -W018 */</span>

        <span class="kd">var</span> <span class="nx">$content</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">content</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">isMatch</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <p>Match a node dialog</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">$content</span> <span class="o">&amp;&amp;</span> <span class="nx">$content</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">isMatch</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">existingSettings</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nx">existingSettings</span><span class="p">.</span><span class="nx">content</span> <span class="o">&amp;&amp;</span> 
                    <span class="nx">$</span><span class="p">(</span><span class="nx">existingSettings</span><span class="p">.</span><span class="nx">content</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="nx">$content</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="p">};</span>
        <span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <p>match an iframe or ajax dialog</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">settings</span><span class="p">.</span><span class="nx">url</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">isMatch</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">existingSettings</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nx">existingSettings</span><span class="p">.</span><span class="nx">url</span> <span class="o">&amp;&amp;</span> 
                    <span class="nx">existingSettings</span><span class="p">.</span><span class="nx">url</span> <span class="o">===</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">url</span> <span class="o">&amp;&amp;</span> 
                    <span class="o">!!</span><span class="nx">existingSettings</span><span class="p">.</span><span class="nx">ajax</span> <span class="o">===</span> <span class="o">!!</span><span class="nx">settings</span><span class="p">.</span><span class="nx">ajax</span><span class="p">;</span>
            <span class="p">};</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">isMatch</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">_fullIdMap</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">dialog</span> <span class="o">=</span> <span class="nx">_fullIdMap</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">isMatch</span><span class="p">(</span><span class="nx">dialog</span><span class="p">.</span><span class="nx">settings</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">dialog</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <p>Global events (not associated with an instance)</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">$</span><span class="p">.</span><span class="nx">CustomEvent</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">,</span> <span class="s2">&quot;beforeopen&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">CustomEvent</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">CustomEvent</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">,</span> <span class="s2">&quot;beforeclose&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">CustomEvent</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">JQUERY_DATA_KEY</span> <span class="o">=</span> <span class="s2">&quot;modalDialog&quot;</span><span class="p">;</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">modalDialogInstance</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dialog</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="o">!</span><span class="nx">dialog</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">JQUERY_DATA_KEY</span><span class="p">)</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">JQUERY_DATA_KEY</span><span class="p">,</span> <span class="nx">dialog</span><span class="p">);</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <p>Idiomatic jQuery interface for node dialogs.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">modalDialog</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">settings</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">dialog</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <p>If the first argument is a string, it is a method name to call on the dialog
associated with the DOM element.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">settings</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">action</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">;</span>
            <span class="nx">dialog</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">modalDialogInstance</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">dialog</span> <span class="o">&amp;&amp;</span> <span class="nx">dialog</span><span class="p">[</span><span class="nx">action</span><span class="p">])</span>
            <span class="p">{</span>
                <span class="nx">dialog</span><span class="p">[</span><span class="nx">action</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="nx">dialog</span><span class="p">,</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>
</pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <p>Otherwise, create a new dialog.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="nx">settings</span> <span class="o">=</span> <span class="nx">settings</span> <span class="o">||</span> <span class="p">{};</span>
            <span class="nx">settings</span><span class="p">.</span><span class="nx">content</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

            <span class="nx">dialog</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">settings</span><span class="p">);</span>

            <span class="nx">dialog</span><span class="p">.</span><span class="nx">open</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <p>A map of actions that can be passed as the "dialogCmd" argument in posted messages from IFrameDialog dialog proxies.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">messageActions</span> <span class="o">=</span> 
    <span class="p">{</span>
        <span class="nx">setHeight</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dialog</span><span class="p">,</span> <span class="nx">qs</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">dialog</span><span class="p">.</span><span class="nx">setHeight</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">qs</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="nx">qs</span><span class="p">.</span><span class="nx">center</span> <span class="o">===</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="nx">qs</span><span class="p">.</span><span class="nx">skipAnimation</span> <span class="o">===</span> <span class="s2">&quot;true&quot;</span><span class="p">);</span>
        <span class="p">},</span>

        <span class="nx">setTitle</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dialog</span><span class="p">,</span> <span class="nx">qs</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">dialog</span><span class="p">.</span><span class="nx">setTitle</span><span class="p">(</span><span class="nx">qs</span><span class="p">.</span><span class="nx">title</span><span class="p">);</span>
        <span class="p">},</span>

        <span class="nx">open</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dialog</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">dialog</span><span class="p">.</span><span class="nx">open</span><span class="p">();</span>
        <span class="p">},</span>

        <span class="nx">close</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dialog</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">dialog</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
        <span class="p">},</span>

        <span class="nx">create</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span>
        <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <p>do nothing- the dialog was created already</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="p">},</span>

        <span class="nx">center</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dialog</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">dialog</span><span class="p">.</span><span class="nx">center</span><span class="p">();</span>
        <span class="p">},</span>

        <span class="nx">notifyReady</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dialog</span><span class="p">,</span> <span class="nx">qs</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nx">dialog</span><span class="p">.</span><span class="nx">notifyReady</span><span class="p">(</span><span class="nx">qs</span><span class="p">.</span><span class="nx">hostname</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="kd">var</span> <span class="nx">messageHandler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">qs</span><span class="p">;</span>

        <span class="k">try</span>
        <span class="p">{</span>
            <span class="nx">qs</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">deparam</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">originalEvent</span> <span class="o">?</span> <span class="nx">e</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">.</span><span class="nx">data</span> <span class="o">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="nx">ex</span><span class="p">)</span>
        <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <p>ignore- it wasn't a message for the dialog framework</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <p>messages in the dialog framework contain "dialogCmd"</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">qs</span> <span class="o">&amp;&amp;</span> <span class="nx">qs</span><span class="p">.</span><span class="nx">dialogCmd</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">action</span> <span class="o">=</span> <span class="nx">messageActions</span><span class="p">[</span><span class="nx">qs</span><span class="p">.</span><span class="nx">dialogCmd</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">action</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">dialog</span><span class="p">;</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">qs</span><span class="p">.</span><span class="nx">_fullId</span><span class="p">)</span>
                <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>               <p>If a fullId is passed, it can be either for a new dialog or an existing dialog.
$.modalDialog.create() handles both cases.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="nx">dialog</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">qs</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="nx">dialog</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">modalDialog</span><span class="p">.</span><span class="nx">getCurrent</span><span class="p">();</span>
                <span class="p">}</span>

                <span class="nx">action</span><span class="p">(</span><span class="nx">dialog</span><span class="p">,</span> <span class="nx">qs</span><span class="p">);</span>

                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <p>Note: It is a bit odd that even though we have the jquery.postMessage() plugin,
we're still checking its availability and calling the native implementation here.
The reason is that for most browsers (besides old IE) the plugin is unnecessary, 
and it may not be desirable to load it at all.</p>             </td>             <td class="code">               <div class="highlight"><pre>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">receiveMessage</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">receiveMessage</span><span class="p">(</span><span class="nx">messageHandler</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="nx">messageHandler</span><span class="p">);</span>
    <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-111">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-111">&#182;</a>               </div>               <p>Global hook to simplify non-cross domain communication</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nb">window</span><span class="p">.</span><span class="nx">_dialogReceiveMessageManual</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">origin</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">messageHandler</span><span class="p">({</span> <span class="nx">data</span><span class="o">:</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">origin</span><span class="o">:</span> <span class="nx">origin</span><span class="p">}))</span>
        <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">evt</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">);</span>
            <span class="nx">evt</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">message</span><span class="p">;</span>
            <span class="nx">evt</span><span class="p">.</span><span class="nx">origin</span> <span class="o">=</span> <span class="nx">origin</span><span class="p">;</span>
            <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">evt</span><span class="p">,</span> <span class="p">[</span><span class="nx">message</span><span class="p">,</span> <span class="nx">origin</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-112">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-112">&#182;</a>               </div>               <p>jQuery mobile support</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">$</span><span class="p">.</span><span class="nx">mobile</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-113">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-113">&#182;</a>               </div>               <p>Alternate defaults when jQuery mobile is loaded. Work around JQM's quirks.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">_defaults</span> <span class="o">=</span>  <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span>
            <span class="nx">_defaults</span><span class="p">,</span>
            <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-114">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-114">&#182;</a>               </div>               <p>JQM widgets must be in the active data-role="page" element to work
containerElement: ".ui-page.ui-page-active",</p>             </td>             <td class="code">               <div class="highlight"><pre>

</pre></div>             </td>           </tr>                               <tr id="section-115">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-115">&#182;</a>               </div>               <p>Event bubbling breaks many JQM widgets</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="nx">preventEventBubbling</span><span class="o">:</span> <span class="kc">false</span>
            <span class="p">});</span>
    <span class="p">});</span>

<span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 