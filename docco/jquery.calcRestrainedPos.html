<!DOCTYPE html>

<html>
<head>
  <title>jquery.calcRestrainedPos.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="breakpoints.html">
                breakpoints.js
              </a>
            
              
              <a class="source" href="date-parse.html">
                date-parse.js
              </a>
            
              
              <a class="source" href="jquery.breakpoints.html">
                jquery.breakpoints.js
              </a>
            
              
              <a class="source" href="jquery.calcRestrainedPos.html">
                jquery.calcRestrainedPos.js
              </a>
            
              
              <a class="source" href="jquery.clientRect.html">
                jquery.clientRect.js
              </a>
            
              
              <a class="source" href="jquery.contentSize.html">
                jquery.contentSize.js
              </a>
            
              
              <a class="source" href="jquery.cookies.html">
                jquery.cookies.js
              </a>
            
              
              <a class="source" href="jquery.css.html">
                jquery.css.js
              </a>
            
              
              <a class="source" href="jquery.customEvent.html">
                jquery.customEvent.js
              </a>
            
              
              <a class="source" href="jquery.delimitedString.html">
                jquery.delimitedString.js
              </a>
            
              
              <a class="source" href="jquery.disableEvent.html">
                jquery.disableEvent.js
              </a>
            
              
              <a class="source" href="jquery.hostIframe.html">
                jquery.hostIframe.js
              </a>
            
              
              <a class="source" href="jquery.hoverDelay.html">
                jquery.hoverDelay.js
              </a>
            
              
              <a class="source" href="jquery.htmlEncode.html">
                jquery.htmlEncode.js
              </a>
            
              
              <a class="source" href="jquery.imageSize.html">
                jquery.imageSize.js
              </a>
            
              
              <a class="source" href="jquery.isVisibleKeyCode.html">
                jquery.isVisibleKeyCode.js
              </a>
            
              
              <a class="source" href="jquery.menu.html">
                jquery.menu.js
              </a>
            
              
              <a class="source" href="jquery-menu-exampleskin.html">
                jquery-menu-exampleskin.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.deviceFixes.html">
                jquery.modalDialog.deviceFixes.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.getSettings.html">
                jquery.modalDialog.getSettings.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.header.html">
                jquery.modalDialog.header.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.history.html">
                jquery.modalDialog.history.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.html">
                jquery.modalDialog.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.unobtrusive.html">
                jquery.modalDialog.unobtrusive.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.userAgent.html">
                jquery.modalDialog.userAgent.js
              </a>
            
              
              <a class="source" href="jquery.modalDialogContent.header.html">
                jquery.modalDialogContent.header.js
              </a>
            
              
              <a class="source" href="jquery.modalDialogContent.html">
                jquery.modalDialogContent.js
              </a>
            
              
              <a class="source" href="jquery.msAjax.html">
                jquery.msAjax.js
              </a>
            
              
              <a class="source" href="jquery.ns.html">
                jquery.ns.js
              </a>
            
              
              <a class="source" href="jquery.partialLoad.html">
                jquery.partialLoad.js
              </a>
            
              
              <a class="source" href="jquery.postMessage.html">
                jquery.postMessage.js
              </a>
            
              
              <a class="source" href="jquery.proxyAll.html">
                jquery.proxyAll.js
              </a>
            
              
              <a class="source" href="jquery.queryString.html">
                jquery.queryString.js
              </a>
            
              
              <a class="source" href="jquery.richTooltip.html">
                jquery.richTooltip.js
              </a>
            
              
              <a class="source" href="jquery.scrollAnchor.html">
                jquery.scrollAnchor.js
              </a>
            
              
              <a class="source" href="jquery.uncomment.html">
                jquery.uncomment.js
              </a>
            
              
              <a class="source" href="jquery.url.html">
                jquery.url.js
              </a>
            
              
              <a class="source" href="pointy.gestures.html">
                pointy.gestures.js
              </a>
            
              
              <a class="source" href="pointy.html">
                pointy.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>jquery.calcRestrainedPos.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>/ <reference path="jquery.clientRect.js" /></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($)</span> </span>{

    <span class="hljs-keyword">var</span> defaults = {
        apply: <span class="hljs-literal">false</span>,
        container: <span class="hljs-literal">null</span>,
        direction: <span class="hljs-string">'north'</span>,
        offsets: {},
        viewport: <span class="hljs-literal">true</span>
    };

    <span class="hljs-keyword">var</span> nextDirection = {
        <span class="hljs-string">'north'</span>: <span class="hljs-string">'east'</span>,
        <span class="hljs-string">'east'</span>: <span class="hljs-string">'south'</span>,
        <span class="hljs-string">'south'</span>: <span class="hljs-string">'west'</span>,
        <span class="hljs-string">'west'</span>: <span class="hljs-string">'north'</span>
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>calculate a position restrained within a container and the viewport</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.calcRestrainedPos = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(options)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>merge options</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        options = $.extend({}, defaults, options);</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>if the element has different sizes for different positions, then specify them as a <direction,size> hash</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> contentSizes = options.contentSizes;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>the element you are calculating the position for is the content</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> content = options.bounds || $(options.content).clientRect();</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>if you provide us a context (position relative to this element)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> context = options.contextBounds || $(options.context).clientRect();</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>if a container is provided we must keep the position restrained within</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> container = options.containerBounds || (options.container ? $(options.container).clientRect() : <span class="hljs-literal">null</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>areas of the screen that are off-limits to the content</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> obstacles = options.exclusions;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>get the size of the viewport</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> viewport = options.viewportBounds || {
            width: <span class="hljs-built_in">document</span>.documentElement.clientWidth,
            height: <span class="hljs-built_in">document</span>.documentElement.clientHeight
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>get the current scroll position of the window</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> scroll = {
            x: $(<span class="hljs-built_in">window</span>).scrollLeft(),
            y: $(<span class="hljs-built_in">window</span>).scrollTop()
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>allow offsets to be passed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> offsets = $.extend({
            padding: <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>applies spacing to keep content X pixels away from bounds of viewport</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            viewport: <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>applies spacing to keep content X pixels away from bounds of container</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            container: <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>applies spacing to keep content X pixels away from bounds of context</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            vertical: <span class="hljs-number">0</span>,
            horizontal: <span class="hljs-number">0</span>
        }, options.offsets || {});</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>pos we return at the end, we add to this object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> pos = options.reset || {};

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getContentSize</span><span class="hljs-params">(direction)</span> </span>{
            <span class="hljs-keyword">var</span> bounds;
            <span class="hljs-keyword">if</span> (contentSizes) {
                bounds = contentSizes[direction];
            }
            <span class="hljs-keyword">if</span> (!bounds) {
                bounds = content;
            }
            <span class="hljs-keyword">return</span> bounds;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">attemptDirection</span><span class="hljs-params">(direction)</span> </span>{
            <span class="hljs-keyword">switch</span> (direction) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'north'</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>first attempt to position content directly centered above the context</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                pos.top = context.top - content.height - offsets.vertical;
                pos.left = <span class="hljs-built_in">Math</span>.max(offsets.padding, context.left + (context.width / <span class="hljs-number">2</span>) - (content.width / <span class="hljs-number">2</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>If content corner is required to be adjacent to the context edge, then we adjust if necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (options.cornerAdjacent &amp;&amp; !isCornerAdjacent(direction, pos)) {
                    pos.left = context.left + offsets.padding;
                }
                <span class="hljs-keyword">break</span>;

            <span class="hljs-keyword">case</span> <span class="hljs-string">'east'</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>first attempt to position content directly centered right of the context</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                pos.top = context.top + (context.height / <span class="hljs-number">2</span>) - (content.height / <span class="hljs-number">2</span>);
                pos.left = context.left + context.width + offsets.horizontal;</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>If content corner is required to be adjacent to the context edge, then we adjust if necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (options.cornerAdjacent &amp;&amp; !isCornerAdjacent(direction, pos)) {
                    pos.top = context.top + offsets.padding;
                }
                <span class="hljs-keyword">break</span>;

            <span class="hljs-keyword">case</span> <span class="hljs-string">'south'</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>first attempt to position content directly centered below the context</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                pos.top = context.top + context.height + offsets.vertical;
                pos.left = <span class="hljs-built_in">Math</span>.max(offsets.padding, context.left + (context.width / <span class="hljs-number">2</span>) - (content.width / <span class="hljs-number">2</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>If content corner is required to be adjacent to the context edge, then we adjust if necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (options.cornerAdjacent &amp;&amp; !isCornerAdjacent(direction, pos)) {
                    pos.left = context.left + offsets.padding;
                }
                <span class="hljs-keyword">break</span>;

            <span class="hljs-keyword">case</span> <span class="hljs-string">'west'</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>first attempt to position content directly centered right of context</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                pos.top = context.top + (context.height / <span class="hljs-number">2</span>) - (content.height / <span class="hljs-number">2</span>);
                pos.left = context.left - content.width - offsets.horizontal;</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>If content corner is required to be adjacent to the context edge, then we adjust if necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (options.cornerAdjacent &amp;&amp; !isCornerAdjacent(direction, pos)) {
                    pos.top = context.top + offsets.padding;
                }
                <span class="hljs-keyword">break</span>;
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>compensate for a container, if we must</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compensateContainer</span><span class="hljs-params">(direction, posLimits)</span> </span>{
            <span class="hljs-keyword">if</span> (container !== <span class="hljs-literal">null</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>compensate for container, appearing outside to north of container</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (pos.top &lt; container.top) {
                    pos.top = container.top + offsets.container;
                    <span class="hljs-keyword">if</span> (options.cornerAdjacent &amp;&amp; ((direction === <span class="hljs-string">'east'</span>) || (direction === <span class="hljs-string">'west'</span>)) &amp;&amp; !isCornerAdjacent(direction, pos)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Need to keep the corners adjancent, so adjust the position and update the posLimits.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        pos.top = context.top + offsets.padding;
                        posLimits.minY = pos.top;
                    }
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>compensate for container, appearing outside to south of container</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pos.top + content.height &gt; container.top + container.height) {
                    pos.top = container.top + container.height - content.height - offsets.container;
                    <span class="hljs-keyword">if</span> (options.cornerAdjacent &amp;&amp; ((direction === <span class="hljs-string">'east'</span>) || (direction === <span class="hljs-string">'west'</span>)) &amp;&amp; !isCornerAdjacent(direction, pos)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Need to keep the corners adjancent, so adjust the position and update the posLimits.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        pos.top = (context.top + context.height - offsets.padding) - content.height;
                        posLimits.maxY = pos.top;
                    }
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>compensate for container, appearing outside to east of container</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (pos.left + content.width &gt; container.left + container.width) {
                    pos.left = container.left + container.width - content.width - offsets.container;
                    <span class="hljs-keyword">if</span> (options.cornerAdjacent &amp;&amp; ((direction === <span class="hljs-string">'north'</span>) || (direction === <span class="hljs-string">'south'</span>)) &amp;&amp; !isCornerAdjacent(direction, pos)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Need to keep the corners adjancent, so adjust the position and update the posLimits.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        pos.left = (context.left + context.width - offsets.padding) - content.width;
                        posLimits.maxX = pos.left;
                    }
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>compensate for container, appearing outside to west of container</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pos.left &lt; container.left) {
                    pos.left = container.left + offsets.container;
                    <span class="hljs-keyword">if</span> (options.cornerAdjacent &amp;&amp; ((direction === <span class="hljs-string">'north'</span>) || (direction === <span class="hljs-string">'south'</span>)) &amp;&amp; !isCornerAdjacent(direction, pos)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Need to keep the corners adjancent, so adjust the position and update the posLimits.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        pos.left = context.left + offsets.padding;
                        posLimits.minX = pos.left;
                    }
                }
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>compensate for the viewport, if we haven’t opted out</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compensateViewport</span><span class="hljs-params">(direction, posLimits)</span> </span>{
            <span class="hljs-keyword">if</span> (options.viewport === <span class="hljs-literal">true</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>north check</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (pos.top &lt; scroll.y + offsets.viewport) {
                    pos.top = scroll.y + offsets.viewport;
                    <span class="hljs-keyword">if</span> (options.cornerAdjacent &amp;&amp; ((direction === <span class="hljs-string">'east'</span>) || (direction === <span class="hljs-string">'west'</span>)) &amp;&amp; !isCornerAdjacent(direction, pos)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Need to keep the corners adjancent, so adjust the position and update the posLimits.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        pos.top = context.top + offsets.padding;
                        posLimits.minY = pos.top;
                    }
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>south check</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pos.top + content.height &gt; scroll.y + viewport.height) {
                    pos.top = scroll.y + viewport.height - content.height - offsets.viewport;
                    <span class="hljs-keyword">if</span> (options.cornerAdjacent &amp;&amp; ((direction === <span class="hljs-string">'east'</span>) || (direction === <span class="hljs-string">'west'</span>)) &amp;&amp; !isCornerAdjacent(direction, pos)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Need to keep the corners adjancent, so adjust the position and update the posLimits.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        pos.top = (context.top + context.height - offsets.padding) - content.height;
                        posLimits.maxY = pos.top;
                    }
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>east check</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (pos.left + content.width &gt; scroll.x + viewport.width) {
                    pos.left = scroll.x + viewport.width - content.width - offsets.viewport;
                    <span class="hljs-keyword">if</span> (options.cornerAdjacent &amp;&amp; ((direction === <span class="hljs-string">'north'</span>) || (direction === <span class="hljs-string">'south'</span>)) &amp;&amp; !isCornerAdjacent(direction, pos)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Need to keep the corners adjancent, so adjust the position and update the posLimits.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        pos.left = (context.left + context.width - offsets.padding) - content.width;
                        posLimits.maxX = pos.left;
                    }
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>west check</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pos.left &lt; scroll.x + offsets.viewport) {
                    pos.left = scroll.x + offsets.viewport;
                    <span class="hljs-keyword">if</span> (options.cornerAdjacent &amp;&amp; ((direction === <span class="hljs-string">'north'</span>) || (direction === <span class="hljs-string">'south'</span>)) &amp;&amp; !isCornerAdjacent(direction, pos)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Need to keep the corners adjancent, so adjust the position and update the posLimits.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        pos.left = context.left + offsets.padding;
                        posLimits.minX = pos.left;
                    }
                }
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>compensate for exclusions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-comment">/*function compensateObstacles(direction, posLimits) {
            if (obstacles) {
                var box = $.extend({}, content, pos);
                var rect;
                var intersections = []; //track intersections encountered to prevent an infinite loop where bounce between two positions
                for (var i = 0; i &lt; obstacles.length; i++) {
                    rect = obstacles[i];
                    if ($.doBoundingBoxesIntersect(box, rect)) {
</span></pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Intersection found.
 Depending on the position of the content relative to the context (i.e. ‘direction’),
 shift the box so that it doesn’t intersect and then restart the loop.
 The loop should end when all obstacles have been checked or it has been determined
 that no placement is possible without intersecting an obstacle.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                        <span class="hljs-keyword">if</span> (intersections[i]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>We’ve seen this intersection before - just give up.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            box.left = posLimits.maxX + <span class="hljs-number">1</span>;
                            box.top = posLimits.maxY + <span class="hljs-number">1</span>;
                            <span class="hljs-keyword">break</span>;
                        }
                        intersections[i] = <span class="hljs-literal">true</span>;

                        <span class="hljs-keyword">var</span> newPos = {
                            top: box.top,
                            left: box.left
                        };
                        <span class="hljs-keyword">switch</span> (direction) {
                        <span class="hljs-keyword">case</span> <span class="hljs-string">'north'</span>:
                        <span class="hljs-keyword">case</span> <span class="hljs-string">'south'</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <pre><code>  Example cases:
         ------------
     ____|____ rect |
    |__box____|------
   --------------------
   |     context      |

         ------------
     ____|_____rect_|__
    |__box_____________|
   --------------------
   |     context      |

  Solution:
         ------------
</code></pre><p>   <strong><strong>_</strong></strong> |     rect |</p>
<h2 id="-__box____-">  |<strong>box__</strong>|——————</h2>
<pre><code>   |     context      |

        OR
         ------------
         |     rect | _________
         ------------|__box____|
   --------------------
   |     context      |
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>                             
                            <span class="hljs-keyword">if</span> ((box.left &lt; rect.left) &amp;&amp; (box.left + box.width &gt; rect.left)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>shift box left if possible</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                newPos.left = rect.left - (box.width + offsets.horizontal);</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>If content corner is required to be adjacent to the context edge, then we adjust if necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                <span class="hljs-keyword">if</span> (options.cornerAdjacent &amp;&amp; (newPos.left &lt; context.left + offsets.padding) &amp;&amp; (newPos.left + content.width &gt; context.left + context.width - offsets.padding)) {
                                    newPos.left = (context.left + context.width) - (content.width + offsets.padding);
                                }
                                <span class="hljs-keyword">if</span> (newPos.left &lt; posLimits.minX) {</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>cannot shift box that far - try other side:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                    newPos.left = (rect.left + rect.width) + offsets.horizontal;</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>If content corner is required to be adjacent to the context edge, then we adjust if necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                    <span class="hljs-keyword">if</span> (options.cornerAdjacent &amp;&amp; (newPos.left &lt; context.left + offsets.padding) &amp;&amp; (newPos.left + content.width &gt; context.left + context.width - offsets.padding)) {
                                        newPos.left = context.left + offsets.padding;
                                    }
                                    <span class="hljs-keyword">if</span> (newPos.left &gt; posLimits.maxX) {</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>cannot place box in this direction without intersection
stop checking obstacles</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                        i = obstacles.length;
                                    } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>update position limits</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                        posLimits.minX = newPos.left;
                                    }
                                } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>update position limits</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                    posLimits.maxX = newPos.left;
                                }
                            }</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <pre><code>  Example cases:
------------
|   rect __|______
--------|__box____|
   --------------------
   |     context      |

--------------------
|   rect ________  |
--------|__box___|--
   --------------------
   |     context      |

  Solution:
------------
|     rect | _________
------------|__box____|
   --------------------
   |     context      |

         OR
         ------------
</code></pre><p>   <strong><strong>_</strong></strong> |     rect |</p>
<h2 id="-__box____-">  |<strong>box__</strong>|——————</h2>
<pre><code>   |     context      |
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>
                            <span class="hljs-keyword">else</span> { <span class="hljs-comment">// if ((box.left &lt; rect.left + rect.width) &amp;&amp; (box.left + box.width &gt; rect.left + rect.width)) {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>shift box right if possible</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                newPos.left = (rect.left + rect.width) + offsets.horizontal;</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>If content corner is required to be adjacent to the context edge, then we adjust if necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                <span class="hljs-keyword">if</span> (options.cornerAdjacent &amp;&amp; (newPos.left &lt; context.left + offsets.padding) &amp;&amp; (newPos.left + content.width &gt; context.left + context.width - offsets.padding)) {
                                    newPos.left = context.left + offsets.padding;
                                }
                                <span class="hljs-keyword">if</span> (newPos.left &gt; posLimits.maxX) {</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>cannot shift box that far - try other side:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                    newPos.left = rect.left - (box.width + offsets.horizontal);</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>If content corner is required to be adjacent to the context edge, then we adjust if necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                    <span class="hljs-keyword">if</span> (options.cornerAdjacent &amp;&amp; (newPos.left &lt; context.left + offsets.padding) &amp;&amp; (newPos.left + content.width &gt; context.left + context.width - offsets.padding)) {
                                        newPos.left = (context.left + context.width) - (content.width + offsets.padding);
                                    }
                                    <span class="hljs-keyword">if</span> (newPos.left &lt; posLimits.minX) {</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>cannot place box in this direction without intersection
stop checking obstacles</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                        i = obstacles.length;
                                    } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>update position limits</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                        posLimits.maxX = newPos.left;
                                    }
                                } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>update position limits</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                    posLimits.minX = newPos.left;
                                }
                            }
                            box.left = newPos.left;
                            box.right = box.left + box.width;
                            <span class="hljs-keyword">break</span>;

                        <span class="hljs-keyword">case</span> <span class="hljs-string">'west'</span>:
                        <span class="hljs-keyword">case</span> <span class="hljs-string">'east'</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <pre><code>  Example cases:
    _________   ___
</code></pre><p>  ——-|<strong>box__</strong>| |
  | rect     |     |
  ——————     | context
                   |
                   |<em>_</em></p>
<pre><code>     ________   ___
</code></pre><p>  ———| box    | |
  | rect|        | |
  ———|        | | context
        |<strong><em>__</em></strong>| |
                   |<em>_</em></p>
<pre><code>  Solution:
                ___
    _________  |
   |__box____| |
</code></pre><p>  ——————     | context
  | rect     |     |
  ——————     |<em>_</em>
         OR</p>
<pre><code>                ___
</code></pre><p>  ——————     |
  | rect     |     |
  ——————     | context
        <strong><strong>_</strong></strong>  |
       |<strong>box__</strong>| |
                   |<em>_</em></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                            <span class="hljs-keyword">if</span> ((box.top &lt; rect.top) &amp;&amp; (box.top + box.height &gt;= rect.top)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>shift box up if possible</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                newPos.top = rect.top - (box.height + offsets.vertical);</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>If content corner is required to be adjacent to the context edge, then we adjust if necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                <span class="hljs-keyword">if</span> (options.cornerAdjacent &amp;&amp; (newPos.top &lt; context.top + offsets.padding) &amp;&amp; (newPos.top + content.height &gt; context.top + context.height - offsets.padding)) {
                                    newPos.top = (context.top + context.height) - (content.height + offsets.padding);
                                }
                                <span class="hljs-keyword">if</span> (newPos.top &lt; posLimits.minY) {</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>cannot shift box that far - try other side:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                    newPos.top = (rect.top + rect.height) + offsets.vertical;</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>If content corner is required to be adjacent to the context edge, then we adjust if necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                    <span class="hljs-keyword">if</span> (options.cornerAdjacent &amp;&amp; (newPos.top &lt; context.top + offsets.padding) &amp;&amp; (newPos.top + content.height &gt; context.top + context.height - offsets.padding)) {
                                        newPos.top = context.top + offsets.padding;
                                    }
                                    <span class="hljs-keyword">if</span> (newPos.top &gt; posLimits.maxY) {</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>cannot place box in this direction without intersection
stop checking obstacles</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                        i = obstacles.length;
                                    } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>update position limits</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                        posLimits.minY = newPos.top;
                                    }
                                } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>update position limits</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                    posLimits.maxY = newPos.top;
                                }
                            }</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <pre><code>  Example cases:
                ___
</code></pre><p>  ——————     |
  | rect<strong>_</strong>|<strong>_  |
  ——-|</strong>box<strong><em>_| | context
                   |
                   |</em></strong></p>
<pre><code>                ___
</code></pre><p>  ——————     |
  | rect<strong>_</strong>|<strong>_  |
  |    |</strong>box<strong><em>_| | context
  |          |     |
  ——————     |</em></strong></p>
<pre><code>  Solution:
                ___
</code></pre><p>  ——————     |
  | rect     |     |
  ——————     | context
        <strong><strong>_</strong></strong>  |
       |<strong>box__</strong>| |
                   |<em>_</em></p>
<pre><code>     OR
                ___
    _________  |
   |__box____| |
</code></pre><p>  ——————     | context
  | rect     |     |
  ——————     |<em>_</em></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                            <span class="hljs-keyword">else</span> { <span class="hljs-comment">// if ((box.top &gt; rect.top) &amp;&amp; (box.top + box.height &gt; rect.top)) {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>shift box down if possible</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                newPos.top = (rect.top + rect.height) + offsets.vertical;</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>If content corner is required to be adjacent to the context edge, then we adjust if necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                <span class="hljs-keyword">if</span> (options.cornerAdjacent &amp;&amp; (newPos.top &lt; context.top + offsets.padding) &amp;&amp; (newPos.top + content.height &gt; context.top + context.height - offsets.padding)) {
                                    newPos.top = context.top + offsets.padding;
                                }
                                <span class="hljs-keyword">if</span> (newPos.top &gt; posLimits.maxY) {</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>cannot shift box that far - try other side:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                    newPos.top = rect.top - (box.height + offsets.vertical);</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>If content corner is required to be adjacent to the context edge, then we adjust if necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                    <span class="hljs-keyword">if</span> (options.cornerAdjacent &amp;&amp; (newPos.top &lt; context.top + offsets.padding) &amp;&amp; (newPos.top + content.height &gt; context.top + context.height - offsets.padding)) {
                                        newPos.top = (context.top + context.height) - (content.height + offsets.padding);
                                    }
                                    <span class="hljs-keyword">if</span> (newPos.top &lt; posLimits.minY) {</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>cannot place box in this direction without intersection
stop checking obstacles</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                        i = obstacles.length;
                                    } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>update position limits</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                        posLimits.maxY = newPos.top;
                                    }
                                } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>update position limits</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                    posLimits.minY = newPos.top;
                                }
                            }
                            box.top = newPos.top;
                            box.bottom = box.top + box.height;
                            break;
                        } //end switch (direction)
                        if ((i &gt; 0) &amp;&amp; (i &lt; obstacles.length)) {
                            i = -1; //restart loop
                        }
                    } //end if intersection found
                } //end for loop
                pos.left = box.left;
                pos.top = box.top;
            } //end if obstacles
        }*/</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Returns the position in the specified range that avoids all of the obstacles on an axis.
 Returns null if no position is possible without intersection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_getBestPositionInRange</span><span class="hljs-params">(minPos, maxPos, contentSize, offset, nextObstacle)</span> </span>{
            <span class="hljs-comment">/*
             * For each object { pos, size } in nextObstacle:
             *  For each range in ranges:
             *      if (pos &lt;= range.min)
             *          if (pos + size &gt; range.min)
             *              range.min = Math.max(range.min, pos+size);
             *          else no overlap
             *      else (pos &gt; range.min)
             *          if (pos + size &gt;= range.max)
             *              range.max = Math.min(rang.max, pos);
             *          else (pos + size &lt; range.max)
             *              //SPLIT the range
             *              range1.min = range.min;
             *              range1.max = pos;
             *              range2.min = pos + size;
             *              range2.max = range.max;
             *              //delete/replace old range from ranges[]
             *              //add new range(s) to ranges[]
             *      else no overlap
             *
             *      if (range.min &gt;= range.max)
             *          delete range from ranges[]
             *          if (ranges.length === 0)
             *              //no possible position
             *              return null;
             *
             * //reduced all ranges by checking all obstacles
             * //Now calculate position by choosing the closest to centered over the context
             *
             */</span>

            <span class="hljs-keyword">var</span> ranges = [{
                min: minPos,
                max: maxPos
            }];
            <span class="hljs-keyword">var</span> i, obstacleStart, obstacleEnd, range;
            <span class="hljs-keyword">var</span> obstacle;
            <span class="hljs-keyword">while</span> (ranges.length &amp;&amp; (obstacle = nextObstacle())) {
                obstacleStart = obstacle.pos - (offset + contentSize);
                obstacleEnd = obstacle.pos + obstacle.size + offset;
                <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; ranges.length; i++) {
                    range = ranges[i];
                    <span class="hljs-keyword">if</span> (obstacleStart &lt;= range.min) {
                        <span class="hljs-keyword">if</span> (obstacleEnd &gt; range.min) {
                            range.min = <span class="hljs-built_in">Math</span>.max(range.min, obstacleEnd);
                        } <span class="hljs-comment">//else no overlap</span>
                    } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>obstacleStart = range.min</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (obstacleEnd &gt;= range.max) {
                            range.max = <span class="hljs-built_in">Math</span>.min(range.max, obstacleStart);
                        } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>obstacle is in the middle of the range
 split the range in two</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="hljs-keyword">var</span> newRange = {
                                min: obstacleEnd,
                                max: range.max
                            };
                            range.max = obstacleStart;
                            <span class="hljs-keyword">if</span> (newRange.min &lt; newRange.max) {</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Add new range to list of ranges</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                ranges.splice(i + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, newRange);
                            }
                        }
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>make sure range is still valid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (range.min &gt;= range.max) {</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>invalid range - remove from ranges array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        ranges.splice(i, <span class="hljs-number">1</span>);
                        i--;
                    }
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Checked all obstacles across the valid position ranges
Now calculate the position closest to the ideal (centered relative to context).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> idealPos = context.left + (context.width - content.width) / <span class="hljs-number">2</span>;
            <span class="hljs-keyword">var</span> newPos = minPos - <span class="hljs-number">1</span>;
            <span class="hljs-keyword">var</span> delta = <span class="hljs-built_in">Number</span>.MAX_VALUE;
            <span class="hljs-keyword">var</span> rangeDelta;
            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>;
                (i &lt; ranges.length) &amp;&amp; (delta &gt; <span class="hljs-number">0</span>); i++) {
                range = ranges[i];

                <span class="hljs-keyword">if</span> (idealPos &lt; range.min) {</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>ideal position is out of our range</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    rangeDelta = range.min - idealPos;
                    <span class="hljs-keyword">if</span> (rangeDelta &lt; delta) {
                        newPos = range.min;
                        delta = rangeDelta;
                    }
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (idealPos &gt; range.max) {</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>ideal position is out of our range</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    rangeDelta = idealPos - range.max;
                    <span class="hljs-keyword">if</span> (rangeDelta &lt; delta) {
                        newPos = range.max;
                        delta = rangeDelta;
                    }
                } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>ideal position is in our range</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    newPos = idealPos;
                    delta = <span class="hljs-number">0</span>;
                }
            }
            <span class="hljs-keyword">if</span> ((newPos &lt; minPos) || (newPos &gt; maxPos)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>should only happen if ranges.length === 0 here due to loop over obstacles invalidating all ranges.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                newPos = <span class="hljs-literal">null</span>;
            }

            <span class="hljs-keyword">return</span> newPos;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compensateObstacles2</span><span class="hljs-params">(direction, posLimits)</span> </span>{
            <span class="hljs-keyword">if</span> (!obstacles) {
                <span class="hljs-keyword">return</span>;
            }
            <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">var</span> minPos, maxPos, newPos, contentSize;
            <span class="hljs-keyword">var</span> occupiedRects = obstacles.slice(); <span class="hljs-comment">//copy obstacles array so that we may modify it</span>
            <span class="hljs-keyword">if</span> (((direction === <span class="hljs-string">'east'</span>) || (direction === <span class="hljs-string">'west'</span>))) {
                <span class="hljs-keyword">var</span> left = posLimits.minX - offsets.horizontal;
                <span class="hljs-keyword">var</span> right = posLimits.minX + content.width + offsets.horizontal;
                minPos = posLimits.minY;
                maxPos = posLimits.maxY;
                contentSize = content.height;
                <span class="hljs-keyword">if</span> (options.cornerAdjacent &amp;&amp; (content.height &gt; context.height)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Add range that’s off limits where the corners won’t be adjacent.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    occupiedRects.splice(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, {
                        left: left,
                        width: right - left,
                        top: (context.top + context.height) - content.height,
                        height: content.height - context.height
                    });
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>Look for a position in the vertical range</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                newPos = _getBestPositionInRange(minPos, maxPos, contentSize, offsets.vertical, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>iterator that returns a { pos, size } iff it intersects the axis of the range we’re interested in</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">var</span> next = <span class="hljs-literal">null</span>;
                    <span class="hljs-keyword">var</span> rect;
                    <span class="hljs-keyword">for</span> (; !next &amp;&amp; (i &lt; occupiedRects.length); i++) {
                        rect = occupiedRects[i];
                        <span class="hljs-keyword">if</span> ((rect.left &lt;= right) &amp;&amp; (rect.left + rect.width &gt;= left)) {
                            next = {
                                pos: rect.top,
                                size: rect.height
                            };
                        }
                    }
                    <span class="hljs-keyword">return</span> next;
                });
                <span class="hljs-keyword">if</span> (newPos !== <span class="hljs-literal">null</span>) {
                    pos.left = posLimits.minX;
                    pos.top = newPos;
                } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>no valid position</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    pos.left = posLimits.minX - <span class="hljs-number">1</span>;
                    pos.top = posLimits.minY - <span class="hljs-number">1</span>;
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">var</span> top = posLimits.minY - offsets.vertical;
                <span class="hljs-keyword">var</span> bottom = posLimits.minY + content.height + offsets.vertical;
                minPos = posLimits.minX;
                maxPos = posLimits.maxX;
                contentSize = content.width;
                <span class="hljs-keyword">if</span> (options.cornerAdjacent &amp;&amp; (content.width &gt; context.width)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>Add range that’s off limits where the corners won’t be adjacent.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    occupiedRects.splice(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, {
                        top: top,
                        height: bottom - top,
                        left: (context.left + context.width) - content.width,
                        width: content.width - context.width
                    });
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Look for a position in the horizontal range</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                newPos = _getBestPositionInRange(minPos, maxPos, contentSize, offsets.horizontal, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>iterator that returns a { pos, size } iff it intersects the axis of the range we’re interested in</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">var</span> next = <span class="hljs-literal">null</span>;
                    <span class="hljs-keyword">var</span> rect;
                    <span class="hljs-keyword">for</span> (; !next &amp;&amp; (i &lt; occupiedRects.length); i++) {
                        rect = occupiedRects[i];
                        <span class="hljs-keyword">if</span> ((rect.top &lt;= bottom) &amp;&amp; (rect.top + rect.height &gt;= top)) {
                            next = {
                                pos: rect.left,
                                size: rect.width
                            };
                        }
                    }
                    <span class="hljs-keyword">return</span> next;
                });
                <span class="hljs-keyword">if</span> (newPos !== <span class="hljs-literal">null</span>) {
                    pos.left = newPos;
                    pos.top = posLimits.minY;
                } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>no valid position</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    pos.left = posLimits.minX - <span class="hljs-number">1</span>;
                    pos.top = posLimits.minY - <span class="hljs-number">1</span>;
                }
            }
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">calculateMaxPositions</span><span class="hljs-params">(direction, limits)</span> </span>{
            <span class="hljs-keyword">switch</span> (direction) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'north'</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-string">'south'</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>minX is full content width to the west of the container</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                limits.minX = <span class="hljs-built_in">Math</span>.max(limits.minX, (context.left - content.width) + offsets.padding);</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>maxX is full content width to the east of the container</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                limits.maxX = <span class="hljs-built_in">Math</span>.min((context.left + context.width) - offsets.padding, limits.maxX - content.width);</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>minY and maxY are equal since the content shouldn’t be moved vertically</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                limits.minY = limits.maxY = pos.top;
                <span class="hljs-keyword">break</span>;

            <span class="hljs-keyword">case</span> <span class="hljs-string">'east'</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-string">'west'</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>minY is as north as the content can get</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                limits.minY = <span class="hljs-built_in">Math</span>.max(limits.minY, (context.top - content.height) + offsets.padding);</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>maxX is as south as the content can get</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                limits.maxY = <span class="hljs-built_in">Math</span>.min((context.top + context.height) - offsets.padding, limits.maxY - content.height);</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <p>minX and maxX shouldn’t change</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                limits.minX = limits.maxX = pos.left;
                <span class="hljs-keyword">break</span>;
            }
            <span class="hljs-keyword">return</span> limits;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isCornerAdjacent</span><span class="hljs-params">(direction, position)</span> </span>{
            <span class="hljs-keyword">var</span> adjacent = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">switch</span> (direction) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'north'</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-string">'south'</span>:
                adjacent = ((position.left &gt;= context.left + offsets.padding) &amp;&amp; (position.left &lt;= context.left + context.width - offsets.padding)) ||
                    ((position.left + content.width &lt;= context.left + context.width - offsets.padding) &amp;&amp; (position.left + content.width &gt;= context.left + offsets.padding));
                <span class="hljs-keyword">break</span>;

            <span class="hljs-keyword">case</span> <span class="hljs-string">'east'</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-string">'west'</span>:
                adjacent = ((position.top &gt;= context.top + offsets.padding) &amp;&amp; (position.top &lt;= context.top + context.bottom - offsets.padding)) ||
                    ((position.top + content.height &lt;= context.top + context.height - offsets.padding) &amp;&amp; (position.top + content.height &lt;= context.top + context.height - offsets.padding));
                <span class="hljs-keyword">break</span>;
            }
            <span class="hljs-keyword">return</span> adjacent;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_isPointInRange</span><span class="hljs-params">(position, maxPositions)</span> </span>{
            <span class="hljs-keyword">return</span> (position.left &gt;= maxPositions.minX) &amp;&amp; (position.left &lt;= maxPositions.maxX) &amp;&amp;
                (position.top &gt;= maxPositions.minY) &amp;&amp; (position.top &lt;= maxPositions.maxY);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>attempt the direction requested first</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> direction = options.direction;</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>Default to “north” if the direction is invalid.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!(direction <span class="hljs-keyword">in</span> nextDirection)) {
            direction = <span class="hljs-string">'north'</span>;
        }
        <span class="hljs-keyword">var</span> originalDirection = direction;</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>limits of content in each direction</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> origMinX, origMinY, origMaxX, origMaxY;
        origMinX = origMinY = <span class="hljs-number">0</span>;
        origMaxX = viewport.width;
        origMaxY = viewport.height;

        <span class="hljs-keyword">if</span> (container !== <span class="hljs-literal">null</span>) {
            origMinX = container.left + offsets.container;
            origMinY = container.top + offsets.container;
            origMaxX = container.left + container.width - offsets.container;
            origMaxY = container.top + container.height - offsets.container;
        }
        <span class="hljs-keyword">if</span> (options.viewport === <span class="hljs-literal">true</span>) {
            origMinX = <span class="hljs-built_in">Math</span>.max(offsets.viewport, origMinX);
            origMinY = <span class="hljs-built_in">Math</span>.max(offsets.viewport, origMinY);
            origMaxX = <span class="hljs-built_in">Math</span>.min(viewport.width - offsets.viewport, origMaxX);
            origMaxY = <span class="hljs-built_in">Math</span>.min(viewport.height - offsets.viewport, origMaxY);
        }
        <span class="hljs-keyword">var</span> maxBounds;
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            content = getContentSize(direction);
            attemptDirection(direction);
            maxBounds = calculateMaxPositions(direction, {
                minX: origMinX,
                minY: origMinY,
                maxX: origMaxX,
                maxY: origMaxY
            });
            compensateContainer(direction, maxBounds);
            compensateViewport(direction, maxBounds);
            <span class="hljs-keyword">if</span> (_isPointInRange(pos, maxBounds)) {
                compensateObstacles2(direction, maxBounds);
            } <span class="hljs-comment">//Else skip the most expensive step if the position is already out of the maxBounds limits.</span>
            <span class="hljs-keyword">var</span> box = $.extend({}, content, pos);</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>verify position is not over the context and within expected limits</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (<span class="hljs-comment">/*!_isPointInRange(pos, maxBounds) || */</span>
                (options.cornerAdjacent &amp;&amp; !isCornerAdjacent(direction, pos)) ||
                $.doBoundingBoxesIntersect(box, context)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p>check to see if we are about to start over</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (nextDirection[direction] === originalDirection) {</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>Return null to signify that we could not position this content.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (options.giveMeSomething) {
                        <span class="hljs-keyword">break</span>;
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
                    }
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>try again</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                direction = nextDirection[direction];
                <span class="hljs-keyword">continue</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>this direction checks out</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">break</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>calculate the max width to ensure the content is not outside viewport</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        pos.maxWidth = viewport.width - pos.left - offsets.viewport;</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>ensure that the content isn’t too large for the viewport</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (content.width &gt;= viewport.width) {
            pos.width = <span class="hljs-string">'auto'</span>;
            pos.left = <span class="hljs-string">'0px'</span>;
            pos.margin = <span class="hljs-string">'0 '</span> + offsets.padding + <span class="hljs-string">'px'</span>;
            pos.maxWidth = <span class="hljs-string">'100%'</span>;
        }

        <span class="hljs-keyword">return</span> {
            direction: direction,
            pos: pos
        };
    };

    $.doBoundingBoxesIntersect = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doBoundingBoxesIntersect</span><span class="hljs-params">(a, b)</span> </span>{
        <span class="hljs-keyword">return</span> (a.left &lt; b.left + b.width &amp;&amp; a.left + a.width &gt; b.left &amp;&amp; a.top &lt; b.top + b.height &amp;&amp; a.top + a.height &gt; b.top);
    };

})(jQuery);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
